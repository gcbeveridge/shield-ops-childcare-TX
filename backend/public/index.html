<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shield Ops - Child Care Safety Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4f46e5;
            --primary-light: #6366f1;
            --primary-dark: #4338ca;
            --secondary: #8b5cf6;
            --secondary-light: #a78bfa;
            --accent: #06b6d4;
            --success: #059669;
            --success-light: #10b981;
            --warning: #d97706;
            --warning-light: #f59e0b;
            --danger: #dc2626;
            --danger-light: #ef4444;
            --info: #0284c7;
            --info-light: #0ea5e9;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #8b5cf6 100%);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Auth Pages */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-card {
            background: white;
            border-radius: 20px;
            padding: 48px;
            max-width: 460px;
            width: 100%;
            box-shadow: var(--shadow-xl);
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-logo-icon {
            font-size: 60px;
            margin-bottom: 16px;
        }

        .auth-logo h1 {
            font-size: 28px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .auth-logo p {
            color: var(--gray-700);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 24px;
            position: relative;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
            letter-spacing: 0.01em;
            transition: all var(--transition-base);
        }

        .form-input {
            width: 100%;
            padding: 13px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 15px;
            transition: all var(--transition-base);
            background: var(--gray-50);
            color: var(--gray-900);
            font-weight: 500;
        }

        .form-input:hover {
            border-color: var(--gray-300);
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
            transform: translateY(-1px);
        }

        .form-input::placeholder {
            color: var(--gray-400);
        }

        .form-input.error {
            border-color: var(--danger);
        }

        .form-input.error:focus {
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .form-input.success {
            border-color: var(--success);
        }

        .form-error {
            color: var(--danger);
            font-size: 12px;
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .form-success {
            color: var(--success);
            font-size: 12px;
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn {
            width: 100%;
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.02em;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px -4px rgba(79, 70, 229, 0.4);
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--gray-50);
            border-color: var(--gray-300);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-danger:hover:not(:disabled) {
            background: var(--danger-light);
            transform: translateY(-2px);
            box-shadow: 0 12px 24px -4px rgba(220, 38, 38, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .auth-footer {
            text-align: center;
            margin-top: 24px;
            font-size: 14px;
            color: var(--gray-700);
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        /* App Layout */
        .app-container {
            display: none;
            min-height: 100vh;
            background: linear-gradient(to bottom, #f8fafc, #e2e8f0);
        }

        .app-container.active {
            display: flex;
        }

        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid var(--gray-200);
            padding: 24px 0;
            overflow-y: auto;
            box-shadow: var(--shadow-sm);
        }

        .logo-section {
            padding: 0 24px 24px;
            border-bottom: 1px solid var(--gray-200);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 36px;
        }

        .logo-text h1 {
            font-size: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text p {
            font-size: 12px;
            color: var(--gray-700);
        }

        .facility-info {
            padding: 16px 24px;
            margin: 16px 0;
            background: var(--gray-50);
            border-left: 3px solid var(--primary);
        }

        .facility-info h3 {
            font-size: 14px;
            color: var(--gray-900);
            margin-bottom: 4px;
        }

        .facility-info p {
            font-size: 12px;
            color: var(--gray-700);
        }

        .nav-menu {
            padding: 16px 0;
        }

        .nav-section-title {
            padding: 8px 24px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--gray-700);
            letter-spacing: 0.5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition-base);
            font-size: 14px;
            font-weight: 500;
            position: relative;
        }

        .nav-item:hover {
            background: var(--gray-50);
            color: var(--primary);
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(79, 70, 229, 0.08), transparent);
            color: var(--primary);
            border-left: 3px solid var(--primary);
            font-weight: 600;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary);
            box-shadow: 0 0 12px rgba(79, 70, 229, 0.5);
        }

        .nav-badge {
            margin-left: auto;
            background: linear-gradient(135deg, var(--danger), var(--danger-light));
            color: white;
            font-size: 11px;
            padding: 3px 9px;
            border-radius: 14px;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(220, 38, 38, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .main-content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            color: var(--gray-900);
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .page-subtitle {
            color: var(--gray-600);
            font-size: 16px;
            font-weight: 400;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: var(--shadow);
            transition: all var(--transition-slow);
            border: 1px solid var(--gray-100);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity var(--transition-base);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--gray-200);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            margin-bottom: 20px;
            transition: all var(--transition-base);
            position: relative;
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 8px;
            letter-spacing: -0.02em;
            line-height: 1;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: var(--shadow);
            margin-bottom: 28px;
            border: 1px solid var(--gray-100);
            transition: all var(--transition-base);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .btn-small {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            letter-spacing: 0.01em;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary-small {
            background: var(--primary);
            color: white;
        }

        .btn-primary-small:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary-small {
            background: white;
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
        }

        .btn-secondary-small:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        .btn-danger-small {
            background: var(--danger);
            color: white;
        }

        .btn-danger-small:hover {
            background: var(--danger-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 2px solid var(--gray-200);
        }

        .tab {
            padding: 12px 20px;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-500);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all var(--transition-base);
            letter-spacing: 0.01em;
        }

        .tab:hover {
            color: var(--primary);
            background: var(--gray-50);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: linear-gradient(to bottom, rgba(79, 70, 229, 0.03), transparent);
        }

        /* Table */
        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .table th {
            text-align: left;
            padding: 14px 16px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--gray-600);
            border-bottom: 2px solid var(--gray-200);
            background: var(--gray-50);
            letter-spacing: 0.05em;
            position: relative;
            cursor: pointer;
            user-select: none;
        }

        .table th:hover {
            background: var(--gray-100);
        }

        .table th::after {
            content: '⇅';
            position: absolute;
            right: 8px;
            opacity: 0.3;
            font-size: 10px;
        }

        .table tbody tr {
            transition: all var(--transition-base);
        }

        .table tbody tr:nth-child(even) {
            background: var(--gray-50);
        }

        .table tbody tr:hover {
            background: linear-gradient(90deg, rgba(79, 70, 229, 0.03), transparent);
            transform: scale(1.001);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .table td {
            padding: 18px 16px;
            border-bottom: 1px solid var(--gray-100);
            font-size: 14px;
            color: var(--gray-700);
        }

        .table td:first-child {
            font-weight: 600;
            color: var(--gray-900);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.01em;
            transition: all var(--transition-base);
        }

        .badge-high {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .badge-medium {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .badge-low {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .badge-complete {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .badge-pending {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .badge-overdue {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
            border-radius: 6px;
            transition: all var(--transition-base);
        }

        .checkbox:hover {
            transform: scale(1.1);
        }

        .checkbox:checked {
            accent-color: var(--success);
        }

        .progress-bar {
            height: 10px;
            background: var(--gray-200);
            border-radius: 10px;
            overflow: hidden;
            margin: 16px 0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border-radius: 10px;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 36px;
            max-width: 500px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            margin-bottom: 28px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-100);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
            letter-spacing: -0.01em;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            margin-top: 28px;
            padding-top: 24px;
            border-top: 2px solid var(--gray-100);
        }

        /* Training Grid */
        .training-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .training-card {
            background: white;
            border-radius: 14px;
            padding: 24px;
            border: 2px solid var(--gray-200);
            cursor: pointer;
            transition: all var(--transition-slow);
            position: relative;
            overflow: hidden;
        }

        .training-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform var(--transition-base);
        }

        .training-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .training-card:hover::before {
            transform: scaleX(1);
        }

        .training-card.complete {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.04), transparent);
        }

        .training-card.complete::before {
            background: var(--success);
            transform: scaleX(1);
        }

        .training-month {
            font-size: 12px;
            color: var(--gray-700);
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .training-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 12px;
        }

        .training-completion {
            font-size: 13px;
            color: var(--gray-700);
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .user-menu {
            position: relative;
            padding: 16px 24px;
            border-top: 2px solid var(--gray-100);
            cursor: pointer;
            transition: all var(--transition-base);
            margin-top: auto;
        }

        .user-menu:hover {
            background: var(--gray-50);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-details h4 {
            font-size: 14px;
            color: var(--gray-900);
        }

        .user-details p {
            font-size: 12px;
            color: var(--gray-700);
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            min-width: 300px;
            padding: 16px 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid #10b981;
        }

        .toast.error {
            border-left: 4px solid #ef4444;
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            background: #d1fae5;
            color: #10b981;
        }

        .toast.error .toast-icon {
            background: #fee2e2;
            color: #ef4444;
        }

        .toast-message {
            flex: 1;
            color: var(--gray-900);
            font-size: 14px;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
        }

        .toast-close:hover {
            color: var(--gray-700);
        }

        /* Quick Action Buttons Hover */
        .quick-action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2) !important;
        }

        .quick-action-btn:active {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="auth-container">
        <div class="auth-card">
            <div class="auth-logo">
                <div class="auth-logo-icon">
                    <img src="attached_assets/shield CHAMPION LOGO OYR (4)_1759763234301.png" alt="Shield Ops Logo" style="width: 120px; height: auto;">
                </div>
                <h1>Shield Ops</h1>
                <p>Child Care Safety Platform</p>
            </div>
            <form onsubmit="login(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input id="login-email" type="email" class="form-input" placeholder="you@example.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input id="login-password" type="password" class="form-input" placeholder="••••••••" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
            </form>
            <div class="auth-footer">
                Don't have an account? <a href="javascript:void(0);" onclick="showSignup()">Sign Up</a>
            </div>
        </div>
    </div>

    <!-- Signup Screen -->
    <div id="signup-screen" class="auth-container" style="display: none;">
        <div class="auth-card">
            <div class="auth-logo">
                <div class="auth-logo-icon">
                    <img src="attached_assets/shield CHAMPION LOGO OYR (4)_1759763234301.png" alt="Shield Ops Logo" style="width: 120px; height: auto;">
                </div>
                <h1>Shield Ops</h1>
                <p>Create Your Account</p>
            </div>
            <form onsubmit="signup(event)">
                <div class="form-group">
                    <label class="form-label">Your Name</label>
                    <input id="signup-name" type="text" class="form-input" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Facility Name</label>
                    <input id="signup-facility" type="text" class="form-input" placeholder="Bright Futures Learning Center" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input id="signup-address" type="text" class="form-input" placeholder="Austin, TX">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input id="signup-email" type="email" class="form-input" placeholder="you@example.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input id="signup-password" type="password" class="form-input" placeholder="••••••••" required>
                </div>
                <button type="submit" class="btn btn-primary">Create Account</button>
            </form>
            <div class="auth-footer">
                Already have an account? <a href="javascript:void(0);" onclick="showLogin()">Sign In</a>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="attached_assets/shield CHAMPION LOGO OYR (4)_1759763234301.png" alt="Shield Ops Logo" style="height: 40px; width: auto;">
                    </div>
                    <div class="logo-text">
                        <h1>Shield Ops</h1>
                        <p>Safety Platform</p>
                    </div>
                </div>
            </div>

            <div class="facility-info">
                <h3>Bright Futures Learning Center</h3>
                <p>📍 Austin, TX</p>
            </div>

            <div class="nav-menu">
                <div class="nav-section-title">Overview</div>
                <div class="nav-item active" onclick="showScreen('dashboard')">
                    <span>📊</span>
                    <span>Dashboard</span>
                </div>

                <div class="nav-section-title">Compliance</div>
                <div class="nav-item" onclick="showScreen('licensing')">
                    <span>📋</span>
                    <span>State Licensing</span>
                    <span class="nav-badge">18</span>
                </div>

                <div class="nav-section-title">Operations</div>
                <div class="nav-item" onclick="showScreen('training')">
                    <span>📚</span>
                    <span>Training Hub</span>
                </div>
                <div class="nav-item" onclick="showScreen('staff')">
                    <span>👥</span>
                    <span>Staff Management</span>
                    <span class="nav-badge">3</span>
                </div>
                <div class="nav-item" onclick="showScreen('incidents')">
                    <span>🚨</span>
                    <span>Incident Reports</span>
                </div>
                <div class="nav-item" onclick="showScreen('checklist')">
                    <span>✓</span>
                    <span>Daily Checklist</span>
                </div>
                <div class="nav-item" onclick="showScreen('documents')">
                    <span>📁</span>
                    <span>Document Vault</span>
                    <span class="nav-badge">5</span>
                </div>
                <div class="nav-item" onclick="showScreen('medication')">
                    <span>💊</span>
                    <span>Medication Tracking</span>
                </div>
            </div>

            <div class="user-menu" onclick="logout()">
                <div class="user-info">
                    <div class="user-avatar">JD</div>
                    <div class="user-details">
                        <h4>John Doe</h4>
                        <p>Logout</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Screen (Modern CAC-Style) -->
            <div id="dashboard" class="screen active">
                <!-- Header -->
                <div style="background: white; padding: 20px 32px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; margin: -24px -24px 24px -24px;">
                    <div>
                        <h1 style="font-size: 24px; font-weight: 700; margin: 0; color: #111827;" id="dashboard-greeting">Welcome back!</h1>
                        <p style="font-size: 14px; color: #6b7280; margin: 4px 0 0 0;">Here's your facility status for today</p>
                    </div>
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div id="weather-widget-placeholder"></div>
                        <div id="user-avatar" style="width: 40px; height: 40px; background: #e0e7ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: #4f46e5; cursor: pointer;">
                            SC
                        </div>
                    </div>
                </div>
                
                <div style="padding: 0px;">
                    <!-- Weather Alert Widget -->
                    <div id="weather-alert-widget" style="display: none; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 16px; padding: 24px; margin-bottom: 24px; color: white; cursor: pointer;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <span id="weather-icon" style="font-size: 32px;"></span>
                            <div style="flex: 1;">
                                <div style="font-size: 18px; font-weight: 700;" id="weather-title"></div>
                                <div style="font-size: 14px; opacity: 0.9;" id="weather-location"></div>
                            </div>
                            <div style="font-size: 36px; font-weight: 700;" id="weather-temp"></div>
                        </div>
                        <div style="font-size: 14px; opacity: 0.95; line-height: 1.5;" id="weather-recommendation"></div>
                    </div>
                    
                    <!-- Combined Safety Score + Streak -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 32px; margin-bottom: 24px; color: white; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">Overall Safety Performance</div>
                                <div style="display: flex; align-items: baseline; gap: 12px;">
                                    <div style="font-size: 64px; font-weight: 700; line-height: 1;" id="risk-score-display">87</div>
                                    <div style="font-size: 20px; font-weight: 600;" id="risk-rating-display">Excellent</div>
                                </div>
                                <div style="font-size: 14px; opacity: 0.9; margin-top: 8px;" id="risk-change-display">↑ 3 from last month</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 48px; font-weight: 700; line-height: 1; margin-bottom: 8px;" id="streak-days-display">15</div>
                                <div style="font-size: 14px; opacity: 0.9;">Days Incident-Free</div>
                                <div style="background: rgba(255,255,255,0.2); border-radius: 8px; padding: 8px 16px; margin-top: 12px; font-size: 12px;">
                                    ⭐ Next Goal: <span id="next-goal-display">30 Day Safety Star</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Attention Needed Section -->
                    <div id="attention-section" style="display: none; margin-bottom: 32px;">
                        <h2 style="font-size: 18px; font-weight: 700; color: #111827; margin-bottom: 16px;">🔔 Attention Needed</h2>
                        <div id="attention-alerts-container" style="display: flex; flex-direction: column; gap: 12px;"></div>
                    </div>
                    
                    <!-- Today's Priorities -->
                    <div style="margin-bottom: 32px;">
                        <h2 style="font-size: 18px; font-weight: 700; color: #111827; margin-bottom: 16px;">📅 Today's Priorities</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                            <!-- Missing Docs Card -->
                            <div id="priority-missing-docs" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 12px; padding: 24px; color: white; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); cursor: pointer;" onclick="showScreen('documents')">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                                        ⚠️
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 12px; opacity: 0.9;">Critical</div>
                                        <div style="font-size: 18px; font-weight: 700;">Missing Documents</div>
                                    </div>
                                </div>
                                <div style="font-size: 14px; opacity: 0.95; margin-bottom: 16px;" id="missing-docs-description">Required facility documents not on file</div>
                                <div style="background: white; color: #ef4444; text-align: center; padding: 10px; border-radius: 8px; font-weight: 600; font-size: 14px;">
                                    Upload Now
                                </div>
                            </div>
                            
                            <!-- Expired Docs Card -->
                            <div id="priority-expired-docs" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); border-radius: 12px; padding: 24px; color: white; box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3); cursor: pointer;" onclick="showScreen('documents')">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                                        📅
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 12px; opacity: 0.9;">Urgent</div>
                                        <div style="font-size: 18px; font-weight: 700;">Expired Documents</div>
                                    </div>
                                </div>
                                <div style="font-size: 14px; opacity: 0.95; margin-bottom: 16px;" id="expired-docs-description">Documents need renewal immediately</div>
                                <div style="background: white; color: #f97316; text-align: center; padding: 10px; border-radius: 8px; font-weight: 600; font-size: 14px;">
                                    Renew Now
                                </div>
                            </div>
                            
                            <!-- Missing Signatures Card -->
                            <div id="priority-signatures" style="background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%); border-radius: 12px; padding: 24px; color: white; box-shadow: 0 4px 12px rgba(234, 179, 8, 0.3); cursor: pointer;" onclick="showScreen('incidents')">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                    <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                                        ✍️
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 12px; opacity: 0.9;">Pending</div>
                                        <div style="font-size: 18px; font-weight: 700;">Missing Signatures</div>
                                    </div>
                                </div>
                                <div style="font-size: 14px; opacity: 0.95; margin-bottom: 16px;" id="signatures-description">Incident reports awaiting parent signatures</div>
                                <div style="background: white; color: #eab308; text-align: center; padding: 10px; border-radius: 8px; font-weight: 600; font-size: 14px;">
                                    Get Signatures
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div style="margin-bottom: 32px;">
                        <h2 style="font-size: 18px; font-weight: 700; color: #111827; margin-bottom: 16px;">⚡ Quick Actions</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;" id="quick-actions-container">
                            <button onclick="openModal('new-incident')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 20px; border-radius: 12px; cursor: pointer; text-align: left; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);" class="quick-action-btn">
                                <div style="font-size: 28px; margin-bottom: 8px;">🚨</div>
                                <div style="font-size: 15px; font-weight: 600; margin-bottom: 4px;">Log Incident</div>
                                <div style="font-size: 12px; opacity: 0.9;">Document injury or illness</div>
                            </button>
                            
                            <button onclick="openModal('administer-medication')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; padding: 20px; border-radius: 12px; cursor: pointer; text-align: left; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 12px rgba(245, 87, 108, 0.3);" class="quick-action-btn">
                                <div style="font-size: 28px; margin-bottom: 8px;">💊</div>
                                <div style="font-size: 15px; font-weight: 600; margin-bottom: 4px;">Log Medication</div>
                                <div style="font-size: 12px; opacity: 0.9;">Record dose given</div>
                            </button>
                            
                            <button onclick="showScreen('documents')" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; padding: 20px; border-radius: 12px; cursor: pointer; text-align: left; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);" class="quick-action-btn">
                                <div style="font-size: 28px; margin-bottom: 8px;">📁</div>
                                <div style="font-size: 15px; font-weight: 600; margin-bottom: 4px;">Upload Document</div>
                                <div style="font-size: 12px; opacity: 0.9;">Add certificates</div>
                            </button>
                            
                            <button onclick="showScreen('staff')" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; border: none; padding: 20px; border-radius: 12px; cursor: pointer; text-align: left; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);" class="quick-action-btn">
                                <div style="font-size: 28px; margin-bottom: 8px;">👥</div>
                                <div style="font-size: 15px; font-weight: 600; margin-bottom: 4px;">Manage Staff</div>
                                <div style="font-size: 12px; opacity: 0.9;">View staff records</div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h2 style="font-size: 18px; font-weight: 700; color: #111827;">Recent Activity</h2>
                            <a href="#" style="color: #3b82f6; text-decoration: none; font-size: 14px; font-weight: 600;">View All →</a>
                        </div>
                        <div style="background: white; border-radius: 12px; border: 1px solid #e5e7eb; padding: 20px;" id="recent-activity-container">
                            <!-- Recent activity items will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- State Licensing Screen -->
            <div id="licensing" class="screen">
                <div class="page-header">
                    <h1 class="page-title">State Licensing 📋</h1>
                    <p class="page-subtitle">Texas Child Care Minimum Standards Compliance</p>
                </div>

                <div class="card">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">Overall Compliance</h3>
                    <div style="font-size: 32px; font-weight: 700; color: var(--gray-900);">94%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 94%;"></div>
                    </div>
                    <p style="font-size: 13px; color: var(--gray-700);">11 of 12 requirements complete</p>
                </div>

                <div class="card">
                    <div class="tabs">
                        <button class="tab active" onclick="filterRequirements('all')">All (12)</button>
                        <button class="tab" onclick="filterRequirements('complete')">Complete (11)</button>
                        <button class="tab" onclick="filterRequirements('pending')">Pending (1)</button>
                        <button class="tab" onclick="filterRequirements('overdue')">Overdue (0)</button>
                    </div>

                    <table class="table">
                        <thead>
                            <tr>
                                <th>Requirement</th>
                                <th>Category</th>
                                <th>Priority</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Complete</th>
                            </tr>
                        </thead>
                        <tbody id="requirements-table">
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Orientation Training</strong><br><small>Emergency procedures, abuse reporting, policies</small></td>
                                <td>📚 Staff Training</td>
                                <td><span class="badge badge-medium">Medium-High</span></td>
                                <td>Within 7 days</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Pre-Service Training</strong><br><small>8 clock hours on child development & safety</small></td>
                                <td>📚 Staff Training</td>
                                <td><span class="badge badge-medium">Medium-High</span></td>
                                <td>Within 90 days</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Pediatric First Aid</strong><br><small>All staff must have current certification</small></td>
                                <td>📚 Staff Training</td>
                                <td><span class="badge badge-medium">Medium-High</span></td>
                                <td>Within 90 days</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Pediatric CPR</strong><br><small>AHA guidelines, must stay current</small></td>
                                <td>📚 Staff Training</td>
                                <td><span class="badge badge-medium">Medium-High</span></td>
                                <td>Within 90 days</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Annual Training - Caregivers</strong><br><small>15 clock hours covering 8 required topics</small></td>
                                <td>📚 Staff Training</td>
                                <td><span class="badge badge-medium">Medium-High</span></td>
                                <td>Annually</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                            <tr class="requirement-row" data-status="pending">
                                <td><strong>Annual Training - Directors</strong><br><small>20 clock hours including management training</small></td>
                                <td>📚 Staff Training</td>
                                <td><span class="badge badge-medium">Medium-High</span></td>
                                <td>Dec 15, 2025</td>
                                <td><span class="badge badge-pending">Pending</span></td>
                                <td><input type="checkbox" class="checkbox"></td>
                            </tr>
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Transportation Safety Training</strong><br><small>2 clock hours for drivers (if applicable)</small></td>
                                <td>📚 Staff Training</td>
                                <td><span class="badge badge-medium">Medium-High</span></td>
                                <td>Annually</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Background Checks</strong><br><small>Criminal history & sex offender registry</small></td>
                                <td>🏢 Facility</td>
                                <td><span class="badge badge-high">High</span></td>
                                <td>Before hire</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Tuberculosis Screening</strong><br><small>Risk assessment for all employees</small></td>
                                <td>🏢 Facility</td>
                                <td><span class="badge badge-medium">Medium</span></td>
                                <td>At hire</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Child Health Records</strong><br><small>Immunizations, health statements, care plans</small></td>
                                <td>⚙️ Operational</td>
                                <td><span class="badge badge-medium">Medium</span></td>
                                <td>At enrollment</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Attendance Records</strong><br><small>Daily sign-in/out & employee timesheets</small></td>
                                <td>⚙️ Operational</td>
                                <td><span class="badge badge-low">Medium-Low</span></td>
                                <td>Daily</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                            <tr class="requirement-row" data-status="complete">
                                <td><strong>Minimum Caregiver Qualifications</strong><br><small>High school diploma, 18+ years old</small></td>
                                <td>⚙️ Operational</td>
                                <td><span class="badge badge-medium">Medium</span></td>
                                <td>At hire</td>
                                <td><span class="badge badge-complete">Complete</span></td>
                                <td><input type="checkbox" class="checkbox" checked disabled></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Training Hub Screen -->
            <div id="training" class="screen">
                <div class="page-header">
                    <h1 class="page-title">Training Hub 📚</h1>
                    <p class="page-subtitle">12-Month Safety & Compliance Curriculum</p>
                </div>

                <div class="card" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Current Month: October 2025</h3>
                    <p style="font-size: 14px; color: var(--gray-700); margin-bottom: 16px;">Module: OSHA Compliance Review</p>
                    <div style="display: flex; gap: 16px; align-items: center;">
                        <div style="flex: 1;">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--success);">100%</div>
                    </div>
                    <p style="font-size: 13px; color: var(--gray-700); margin-top: 8px;">All 15 staff members completed ✓</p>
                </div>

                <div class="training-grid">
                    <div class="training-card complete">
                        <div class="training-month">January</div>
                        <div class="training-title">Emergency Preparedness & Fire Safety</div>
                        <div class="training-completion">✓ Complete - 15/15 staff</div>
                    </div>
                    <div class="training-card complete">
                        <div class="training-month">February</div>
                        <div class="training-title">Child Protection & Abuse Prevention</div>
                        <div class="training-completion">✓ Complete - 15/15 staff</div>
                    </div>
                    <div class="training-card complete">
                        <div class="training-month">March</div>
                        <div class="training-title">First Aid & Medical Emergencies</div>
                        <div class="training-completion">✓ Complete - 15/15 staff</div>
                    </div>
                    <div class="training-card complete">
                        <div class="training-month">April</div>
                        <div class="training-title">Food Safety & Allergy Management</div>
                        <div class="training-completion">✓ Complete - 15/15 staff</div>
                    </div>
                    <div class="training-card complete">
                        <div class="training-month">May</div>
                        <div class="training-title">Playground Safety & Equipment Inspection</div>
                        <div class="training-completion">✓ Complete - 15/15 staff</div>
                    </div>
                    <div class="training-card complete">
                        <div class="training-month">June</div>
                        <div class="training-title">Water Safety & Summer Protocols</div>
                        <div class="training-completion">✓ Complete - 15/15 staff</div>
                    </div>
                    <div class="training-card complete">
                        <div class="training-month">July</div>
                        <div class="training-title">Active Threat Response</div>
                        <div class="training-completion">✓ Complete - 15/15 staff</div>
                    </div>
                    <div class="training-card complete">
                        <div class="training-month">August</div>
                        <div class="training-title">Health & Illness Management</div>
                        <div class="training-completion">✓ Complete - 15/15 staff</div>
                    </div>
                    <div class="training-card complete">
                        <div class="training-month">September</div>
                        <div class="training-title">Transportation Safety</div>
                        <div class="training-completion">✓ Complete - 15/15 staff</div>
                    </div>
                    <div class="training-card complete">
                        <div class="training-month">October</div>
                        <div class="training-title">OSHA Compliance Review</div>
                        <div class="training-completion">✓ Complete - 15/15 staff</div>
                    </div>
                    <div class="training-card">
                        <div class="training-month">November</div>
                        <div class="training-title">Severe Weather Preparedness</div>
                        <div class="training-completion">Coming soon</div>
                    </div>
                    <div class="training-card">
                        <div class="training-month">December</div>
                        <div class="training-title">Holiday Safety & Year-End Review</div>
                        <div class="training-completion">Coming soon</div>
                    </div>
                </div>
            </div>

            <!-- Staff Management Screen -->
            <div id="staff" class="screen">
                <div class="page-header">
                    <h1 class="page-title">Staff Management 👥</h1>
                    <p class="page-subtitle">Track certifications and training compliance</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Staff Roster</h2>
                        <button class="btn-small btn-primary-small" onclick="openModal('add-staff')">+ Add Staff</button>
                    </div>

                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Hire Date</th>
                                <th>CPR</th>
                                <th>First Aid</th>
                                <th>Background Check</th>
                                <th>Training</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Sarah Johnson</strong></td>
                                <td>Lead Teacher</td>
                                <td>Jan 15, 2023</td>
                                <td><span class="badge badge-complete">Valid</span></td>
                                <td><span class="badge badge-complete">Valid</span></td>
                                <td><span class="badge badge-complete">Clear</span></td>
                                <td>100%</td>
                            </tr>
                            <tr>
                                <td><strong>Michael Chen</strong></td>
                                <td>Teacher</td>
                                <td>Mar 22, 2023</td>
                                <td><span class="badge badge-complete">Valid</span></td>
                                <td><span class="badge badge-complete">Valid</span></td>
                                <td><span class="badge badge-complete">Clear</span></td>
                                <td>100%</td>
                            </tr>
                            <tr>
                                <td><strong>Emily Rodriguez</strong></td>
                                <td>Assistant Teacher</td>
                                <td>Jun 10, 2024</td>
                                <td><span class="badge" style="background: #fef3c7; color: #92400e;">Exp Nov 15</span></td>
                                <td><span class="badge badge-complete">Valid</span></td>
                                <td><span class="badge badge-complete">Clear</span></td>
                                <td>100%</td>
                            </tr>
                            <tr>
                                <td><strong>David Martinez</strong></td>
                                <td>Teacher</td>
                                <td>Sep 5, 2022</td>
                                <td><span class="badge badge-complete">Valid</span></td>
                                <td><span class="badge" style="background: #fef3c7; color: #92400e;">Exp Nov 28</span></td>
                                <td><span class="badge badge-complete">Clear</span></td>
                                <td>100%</td>
                            </tr>
                            <tr>
                                <td><strong>Lisa Thompson</strong></td>
                                <td>Director</td>
                                <td>Feb 1, 2021</td>
                                <td><span class="badge badge-complete">Valid</span></td>
                                <td><span class="badge badge-complete">Valid</span></td>
                                <td><span class="badge badge-complete">Clear</span></td>
                                <td>95%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Incident Reports Screen -->
            <div id="incidents" class="screen">
                <div class="page-header">
                    <h1 class="page-title">Incident Reports 🚨</h1>
                    <p class="page-subtitle">Document and track all incidents and illnesses</p>
                </div>

                <div class="card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                        <div>
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Pattern Alert</h3>
                            <p style="font-size: 14px; color: var(--gray-700);">3 playground falls reported this month - above average</p>
                        </div>
                        <button class="btn-small btn-primary-small" onclick="openModal('new-incident')">+ Log New Incident</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--gray-900);">8</div>
                            <div style="font-size: 13px; color: var(--gray-700);">Incidents This Month</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--success);">100%</div>
                            <div style="font-size: 13px; color: var(--gray-700);">Parent Notified</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--success);">100%</div>
                            <div style="font-size: 13px; color: var(--gray-700);">Signatures Obtained</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="tabs">
                        <button class="tab active">All Incidents (8)</button>
                        <button class="tab">Injuries (5)</button>
                        <button class="tab">Illness (2)</button>
                        <button class="tab">Behavior (1)</button>
                    </div>

                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date/Time</th>
                                <th>Child</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Staff</th>
                                <th>Parent Notified</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Oct 15, 2025<br><small>2:45 PM</small></td>
                                <td><strong>Emma S.</strong></td>
                                <td><span class="badge badge-high">Injury</span></td>
                                <td>Minor scrape on knee from playground fall</td>
                                <td>Sarah Johnson</td>
                                <td><span class="badge badge-complete">✓ Notified</span></td>
                                <td><span class="badge badge-complete">Signed</span></td>
                            </tr>
                            <tr>
                                <td>Oct 14, 2025<br><small>11:20 AM</small></td>
                                <td><strong>Liam M.</strong></td>
                                <td><span class="badge badge-medium">Illness</span></td>
                                <td>Fever 101°F, sent home</td>
                                <td>Michael Chen</td>
                                <td><span class="badge badge-complete">✓ Notified</span></td>
                                <td><span class="badge badge-complete">Signed</span></td>
                            </tr>
                            <tr>
                                <td>Oct 12, 2025<br><small>3:10 PM</small></td>
                                <td><strong>Olivia K.</strong></td>
                                <td><span class="badge badge-high">Injury</span></td>
                                <td>Bump on forehead from table corner</td>
                                <td>Emily Rodriguez</td>
                                <td><span class="badge badge-complete">✓ Notified</span></td>
                                <td><span class="badge badge-complete">Signed</span></td>
                            </tr>
                            <tr>
                                <td>Oct 10, 2025<br><small>9:30 AM</small></td>
                                <td><strong>Noah B.</strong></td>
                                <td><span class="badge badge-low">Behavior</span></td>
                                <td>Conflict with peer, redirected successfully</td>
                                <td>David Martinez</td>
                                <td><span class="badge badge-complete">✓ Notified</span></td>
                                <td><span class="badge badge-complete">Signed</span></td>
                            </tr>
                            <tr>
                                <td>Oct 8, 2025<br><small>1:45 PM</small></td>
                                <td><strong>Sophia L.</strong></td>
                                <td><span class="badge badge-high">Injury</span></td>
                                <td>Small cut on finger, Band-Aid applied</td>
                                <td>Sarah Johnson</td>
                                <td><span class="badge badge-complete">✓ Notified</span></td>
                                <td><span class="badge badge-complete">Signed</span></td>
                            </tr>
                            <tr>
                                <td>Oct 5, 2025<br><small>10:15 AM</small></td>
                                <td><strong>Jackson P.</strong></td>
                                <td><span class="badge badge-medium">Illness</span></td>
                                <td>Stomach ache, parent picked up early</td>
                                <td>Michael Chen</td>
                                <td><span class="badge badge-complete">✓ Notified</span></td>
                                <td><span class="badge badge-complete">Signed</span></td>
                            </tr>
                            <tr>
                                <td>Oct 3, 2025<br><small>2:20 PM</small></td>
                                <td><strong>Ava W.</strong></td>
                                <td><span class="badge badge-high">Injury</span></td>
                                <td>Scraped elbow on playground slide</td>
                                <td>Emily Rodriguez</td>
                                <td><span class="badge badge-complete">✓ Notified</span></td>
                                <td><span class="badge badge-complete">Signed</span></td>
                            </tr>
                            <tr>
                                <td>Oct 1, 2025<br><small>4:00 PM</small></td>
                                <td><strong>Mason T.</strong></td>
                                <td><span class="badge badge-high">Injury</span></td>
                                <td>Twisted ankle during outdoor play</td>
                                <td>David Martinez</td>
                                <td><span class="badge badge-complete">✓ Notified</span></td>
                                <td><span class="badge badge-complete">Signed</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Daily Checklist Screen -->
            <div id="checklist" class="screen">
                <div class="page-header">
                    <h1 class="page-title">Daily Checklist ✓</h1>
                    <p class="page-subtitle">Complete required daily tasks and maintain audit trail</p>
                </div>

                <div class="card" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div>
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 4px;">Friday, October 3, 2025</h3>
                            <p style="font-size: 14px; color: var(--gray-700);">18 of 20 tasks completed (90%)</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 36px; font-weight: 700; color: var(--success);">90%</div>
                            <div style="font-size: 13px; color: var(--gray-700);">Completion</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 90%;"></div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">📊 Weekly Completion Trend</h3>
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
                        <div style="text-align: center;">
                            <div style="font-size: 11px; color: var(--gray-700); margin-bottom: 8px;">MON</div>
                            <div style="height: 80px; background: var(--success); border-radius: 6px; display: flex; align-items: end; justify-content: center; padding: 8px;">
                                <span style="color: white; font-weight: 600; font-size: 13px;">100%</span>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 11px; color: var(--gray-700); margin-bottom: 8px;">TUE</div>
                            <div style="height: 80px; background: var(--success); border-radius: 6px; display: flex; align-items: end; justify-content: center; padding: 8px;">
                                <span style="color: white; font-weight: 600; font-size: 13px;">95%</span>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 11px; color: var(--gray-700); margin-bottom: 8px;">WED</div>
                            <div style="height: 80px; background: var(--success); border-radius: 6px; display: flex; align-items: end; justify-content: center; padding: 8px;">
                                <span style="color: white; font-weight: 600; font-size: 13px;">100%</span>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 11px; color: var(--gray-700); margin-bottom: 8px;">THU</div>
                            <div style="height: 80px; background: var(--warning); border-radius: 6px; display: flex; align-items: end; justify-content: center; padding: 8px;">
                                <span style="color: white; font-weight: 600; font-size: 13px;">85%</span>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 11px; color: var(--gray-700); margin-bottom: 8px;">FRI</div>
                            <div style="height: 80px; background: var(--success); border-radius: 6px; display: flex; align-items: end; justify-content: center; padding: 8px; opacity: 0.7;">
                                <span style="color: white; font-weight: 600; font-size: 13px;">90%</span>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 11px; color: var(--gray-700); margin-bottom: 8px;">SAT</div>
                            <div style="height: 80px; background: var(--gray-200); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: var(--gray-700); font-size: 11px;">Pending</span>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 11px; color: var(--gray-700); margin-bottom: 8px;">SUN</div>
                            <div style="height: 80px; background: var(--gray-200); border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: var(--gray-700); font-size: 11px;">Closed</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 20px;">Today's Checklist - October 3, 2025</h3>
                    
                    <!-- Morning Safety -->
                    <div style="margin-bottom: 24px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 12px;">🌅 Morning Safety Walk (6:00 AM - 7:00 AM)</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Facility Inspection</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Check all rooms for hazards, broken equipment, tripping hazards</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Completed by Sarah J. at 6:15 AM • 2 photos uploaded</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Emergency Exits Clear</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Verify all emergency exits are unobstructed and functional</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Completed by Sarah J. at 6:18 AM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Playground Inspection</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Check equipment for damage, debris, drainage, surfacing material</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Completed by Michael C. at 6:30 AM • 1 photo uploaded</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Daily Operations -->
                    <div style="margin-bottom: 24px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 12px;">📋 Daily Operations (All Day)</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Attendance Sign-In/Out System</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Verify all children signed in/out with times and parent signatures</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Active monitoring • 42 children signed in today</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Child/Caregiver Ratios</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Monitor ratios in each classroom throughout the day</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ All classrooms compliant • Last checked 2:30 PM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Hand Washing Compliance Spot Check</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Observe staff and children following proper hand washing procedures</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Completed by Emily R. at 11:45 AM • 100% compliance observed</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Medication Log Review</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Verify all medications administered are documented with two-staff signatures</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Completed by Lisa T. at 3:00 PM • 3 medications given today, all documented</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Food Safety -->
                    <div style="margin-bottom: 24px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 12px;">🍽️ Food Safety (Meal Times)</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Food Temperature Check</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Verify hot foods >140°F and cold foods <40°F</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Lunch: Hot 165°F, Cold 38°F • Completed at 12:00 PM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Menu Posted & Followed</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Daily menu visible to parents and meals served match posted menu</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Posted and verified</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Allergy Lists Posted</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Food allergy emergency plan lists visible in kitchen and classrooms</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ All allergy lists current and posted</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cleaning & Sanitation -->
                    <div style="margin-bottom: 24px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 12px;">🧼 Cleaning & Sanitation</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">High-Touch Surface Cleaning</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Doorknobs, light switches, tables sanitized throughout day</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Completed at 9:00 AM, 12:30 PM, 3:30 PM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Bathroom Cleaning & Supply Check</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Bathrooms cleaned, soap and paper towels restocked</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Checked and cleaned at 10:00 AM, 2:00 PM</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Toy & Equipment Sanitizing</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Toys mouthed by infants sanitized after each use</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ Ongoing throughout day • Logged at 11:00 AM, 3:00 PM</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- End of Day -->
                    <div style="margin-bottom: 24px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 12px;">🌙 End of Day (5:00 PM - 6:00 PM)</h4>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                                <input type="checkbox" class="checkbox" checked disabled>
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Final Headcount & Sign-Out</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">All children accounted for and signed out by authorized person</div>
                                    <div style="font-size: 12px; color: var(--success); margin-top: 4px;">✓ All 42 children signed out</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: #fff3cd; border-radius: 8px; border: 2px solid var(--warning);">
                                <input type="checkbox" class="checkbox">
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Security Check & Lock-Up</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">All windows/doors locked, alarm set, lights off</div>
                                    <div style="font-size: 12px; color: var(--warning); margin-top: 4px;">⏳ Pending completion</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: #fff3cd; border-radius: 8px; border: 2px solid var(--warning);">
                                <input type="checkbox" class="checkbox">
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Tomorrow's Prep Notes</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Document any special needs, upcoming events, or maintenance issues</div>
                                    <div style="font-size: 12px; color: var(--warning); margin-top: 4px;">⏳ Pending completion</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Document Vault Screen -->
            <div id="documents" class="screen">
                <div class="page-header">
                    <h1 class="page-title">Document Vault 📁</h1>
                    <p class="page-subtitle">Centralized storage with automatic expiration tracking</p>
                </div>

                <!-- Quick Stats Bar -->
                <div class="card" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 24px; text-align: center;">
                        <div>
                            <div style="font-size: 28px; font-weight: 700; margin-bottom: 4px;">94</div>
                            <div style="font-size: 13px; opacity: 0.9;">Total Documents</div>
                        </div>
                        <div>
                            <div style="font-size: 28px; font-weight: 700; margin-bottom: 4px;">82</div>
                            <div style="font-size: 13px; opacity: 0.9;">Required</div>
                        </div>
                        <div>
                            <div style="font-size: 28px; font-weight: 700; margin-bottom: 4px; color: #fef3c7;">12</div>
                            <div style="font-size: 13px; opacity: 0.9;">Missing</div>
                        </div>
                        <div>
                            <div style="font-size: 28px; font-weight: 700; margin-bottom: 4px;">87%</div>
                            <div style="font-size: 13px; opacity: 0.9;">Compliance</div>
                        </div>
                    </div>
                </div>

                <div class="card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                        <div>
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: var(--danger);">⚠️ Expiration Alerts</h3>
                            <p style="font-size: 14px; color: var(--gray-700);">5 documents require attention</p>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn-small btn-secondary-small" onclick="openModal('inspection-readiness')">📊 Inspection Readiness</button>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document')">+ Upload Document</button>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--danger);">2</div>
                            <div style="font-size: 13px; color: var(--gray-700);">Expired</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--warning);">3</div>
                            <div style="font-size: 13px; color: var(--gray-700);">Expiring in 30 Days</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--success);">89</div>
                            <div style="font-size: 13px; color: var(--gray-700);">Current</div>
                        </div>
                    </div>
                </div>

                <!-- Missing Required Forms Alert -->
                <div class="card" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05)); cursor: pointer;" onclick="openModal('missing-forms')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: var(--warning);">📋 Missing Required Forms</h3>
                            <p style="font-size: 14px; color: var(--gray-700);">12 required documents are not on file - Add them now</p>
                        </div>
                        <div style="font-size: 32px; color: var(--warning);">→</div>
                    </div>
                </div>

                <div class="card">
                    <div class="tabs">
                        <button class="tab active">All Documents (94)</button>
                        <button class="tab">Licensing & Permits</button>
                        <button class="tab">Staff Records (45)</button>
                        <button class="tab">Children (26)</button>
                        <button class="tab">Health & Safety</button>
                        <button class="tab">Facility & Inspections (15)</button>
                        <button class="tab">Insurance (8)</button>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <input type="text" class="form-input" placeholder="🔍 Search documents..." style="max-width: 400px;">
                    </div>

                    <table class="table">
                        <thead>
                            <tr>
                                <th>Document Name</th>
                                <th style="width: 70px;">Form #</th>
                                <th>Category</th>
                                <th>Owner/Subject</th>
                                <th>Issue Date</th>
                                <th>Expiration Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>CPR Certification</strong></td>
                                <td>2971</td>
                                <td>Staff Records</td>
                                <td>Emily Rodriguez</td>
                                <td>Nov 15, 2023</td>
                                <td>Nov 15, 2025</td>
                                <td>
                                    <span class="badge" style="background: #fee2e2; color: #991b1b;">Exp 12 days</span>
                                    <span class="badge" style="background: #dc2626; color: white; font-size: 10px; padding: 2px 6px; margin-left: 4px;">HIGH</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">Renew</button></td>
                            </tr>
                            <tr>
                                <td><strong>First Aid Certification</strong></td>
                                <td>7250</td>
                                <td>Staff Records</td>
                                <td>David Martinez</td>
                                <td>Nov 28, 2023</td>
                                <td>Nov 28, 2025</td>
                                <td>
                                    <span class="badge" style="background: #fef3c7; color: #92400e;">Exp 25 days</span>
                                    <span class="badge" style="background: #f97316; color: white; font-size: 10px; padding: 2px 6px; margin-left: 4px;">MED-HIGH</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">Renew</button></td>
                            </tr>
                            <tr>
                                <td><strong>Fire Inspection Report</strong></td>
                                <td>7263</td>
                                <td>Facility & Inspections</td>
                                <td>Facility</td>
                                <td>Dec 10, 2024</td>
                                <td>Dec 10, 2025</td>
                                <td>
                                    <span class="badge" style="background: #fef3c7; color: #92400e;">Exp 68 days</span>
                                    <span class="badge" style="background: #eab308; color: #713f12; font-size: 10px; padding: 2px 6px; margin-left: 4px;">MEDIUM</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--gray-300); color: var(--gray-700); border: none; border-radius: 4px; cursor: pointer;">View</button></td>
                            </tr>
                            <tr>
                                <td><strong>General Liability Insurance</strong></td>
                                <td>—</td>
                                <td>Insurance</td>
                                <td>Facility</td>
                                <td>Jan 1, 2025</td>
                                <td>Jan 1, 2026</td>
                                <td>
                                    <span class="badge badge-complete">Valid 90 days</span>
                                    <span class="badge" style="background: #fbbf24; color: #78350f; font-size: 10px; padding: 2px 6px; margin-left: 4px;">MED-LOW</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--gray-300); color: var(--gray-700); border: none; border-radius: 4px; cursor: pointer;">View</button></td>
                            </tr>
                            <tr>
                                <td><strong>Food Handler Permit</strong></td>
                                <td>—</td>
                                <td>Health & Safety</td>
                                <td>Kitchen Staff</td>
                                <td>Oct 1, 2023</td>
                                <td>Oct 1, 2025</td>
                                <td>
                                    <span class="badge badge-overdue">Expired 2 days ago</span>
                                    <span class="badge" style="background: #dc2626; color: white; font-size: 10px; padding: 2px 6px; margin-left: 4px;">HIGH</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--danger); color: white; border: none; border-radius: 4px; cursor: pointer;">Renew Now</button></td>
                            </tr>
                            <tr>
                                <td><strong>Background Check</strong></td>
                                <td>2971</td>
                                <td>Staff Records</td>
                                <td>Sarah Johnson</td>
                                <td>Jan 15, 2023</td>
                                <td>N/A</td>
                                <td>
                                    <span class="badge badge-complete">Cleared</span>
                                    <span class="badge" style="background: #dc2626; color: white; font-size: 10px; padding: 2px 6px; margin-left: 4px;">HIGH</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--gray-300); color: var(--gray-700); border: none; border-radius: 4px; cursor: pointer;">View</button></td>
                            </tr>
                            <tr>
                                <td><strong>Health Inspection Report</strong></td>
                                <td>—</td>
                                <td>Health & Safety</td>
                                <td>Facility</td>
                                <td>Mar 15, 2025</td>
                                <td>Mar 15, 2026</td>
                                <td>
                                    <span class="badge badge-complete">Valid 163 days</span>
                                    <span class="badge" style="background: #fbbf24; color: #78350f; font-size: 10px; padding: 2px 6px; margin-left: 4px;">MED-LOW</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--gray-300); color: var(--gray-700); border: none; border-radius: 4px; cursor: pointer;">View</button></td>
                            </tr>
                            <tr>
                                <td><strong>Director's Certificate</strong></td>
                                <td>—</td>
                                <td>Licensing & Permits</td>
                                <td>Lisa Thompson</td>
                                <td>Feb 1, 2021</td>
                                <td>N/A</td>
                                <td>
                                    <span class="badge badge-complete">Valid</span>
                                    <span class="badge" style="background: #dc2626; color: white; font-size: 10px; padding: 2px 6px; margin-left: 4px;">HIGH</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--gray-300); color: var(--gray-700); border: none; border-radius: 4px; cursor: pointer;">View</button></td>
                            </tr>
                            <tr>
                                <td><strong>Child Immunization Record</strong></td>
                                <td>—</td>
                                <td>Children</td>
                                <td>Emma S.</td>
                                <td>Sep 1, 2024</td>
                                <td>Sep 1, 2025</td>
                                <td>
                                    <span class="badge badge-complete">Valid 333 days</span>
                                    <span class="badge" style="background: #6b7280; color: white; font-size: 10px; padding: 2px 6px; margin-left: 4px;">LOW</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--gray-300); color: var(--gray-700); border: none; border-radius: 4px; cursor: pointer;">View</button></td>
                            </tr>
                            <tr>
                                <td><strong>Building Safety Inspection</strong></td>
                                <td>7263</td>
                                <td>Facility & Inspections</td>
                                <td>Facility</td>
                                <td>Apr 20, 2025</td>
                                <td>Apr 20, 2026</td>
                                <td>
                                    <span class="badge badge-complete">Valid 199 days</span>
                                    <span class="badge" style="background: #eab308; color: #713f12; font-size: 10px; padding: 2px 6px; margin-left: 4px;">MEDIUM</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--gray-300); color: var(--gray-700); border: none; border-radius: 4px; cursor: pointer;">View</button></td>
                            </tr>
                            <tr>
                                <td><strong>Vehicle Registration</strong></td>
                                <td>—</td>
                                <td>Facility & Inspections</td>
                                <td>Van #1</td>
                                <td>Aug 1, 2024</td>
                                <td>Aug 1, 2025</td>
                                <td>
                                    <span class="badge badge-overdue">Expired 63 days ago</span>
                                    <span class="badge" style="background: #fbbf24; color: #78350f; font-size: 10px; padding: 2px 6px; margin-left: 4px;">MED-LOW</span>
                                </td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--danger); color: white; border: none; border-radius: 4px; cursor: pointer;">Renew Now</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">📅 Upcoming Expirations (Next 90 Days)</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="padding: 12px; background: var(--gray-50); border-left: 4px solid var(--danger); border-radius: 4px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="font-size: 14px;">Emily Rodriguez - CPR Certification</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Expires: Nov 15, 2025 (12 days)</div>
                                </div>
                                <button class="btn-small btn-primary-small">Set Reminder</button>
                            </div>
                        </div>
                        <div style="padding: 12px; background: var(--gray-50); border-left: 4px solid var(--warning); border-radius: 4px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="font-size: 14px;">David Martinez - First Aid Certification</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Expires: Nov 28, 2025 (25 days)</div>
                                </div>
                                <button class="btn-small btn-primary-small">Set Reminder</button>
                            </div>
                        </div>
                        <div style="padding: 12px; background: var(--gray-50); border-left: 4px solid var(--warning); border-radius: 4px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="font-size: 14px;">Facility - Fire Inspection Report</strong>
                                    <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Expires: Dec 10, 2025 (68 days)</div>
                                </div>
                                <button class="btn-small btn-primary-small">Set Reminder</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medication Tracking Screen -->
            <div id="medication" class="screen">
                <div class="page-header">
                    <h1 class="page-title">Medication Tracking 💊</h1>
                    <p class="page-subtitle">Texas-compliant medication administration and documentation</p>
                </div>

                <div class="card" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                        <div>
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Texas Compliance Status</h3>
                            <p style="font-size: 14px; color: var(--gray-700);">All requirements met per §744.2651-2661</p>
                        </div>
                        <button class="btn-small btn-primary-small" onclick="openModal('add-medication')">+ Add Medication Authorization</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--gray-900);">12</div>
                            <div style="font-size: 13px; color: var(--gray-700);">Active Authorizations</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--success);">100%</div>
                            <div style="font-size: 13px; color: var(--gray-700);">Dual-Staff Verification</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--success);">3</div>
                            <div style="font-size: 13px; color: var(--gray-700);">Doses Given Today</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">🚨 Critical Texas Requirements</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; border-left: 4px solid var(--success);">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <span style="color: var(--success); font-size: 24px;">✓</span>
                                <strong style="font-size: 14px;">Parent Authorization Required</strong>
                            </div>
                            <div style="font-size: 13px; color: var(--gray-700);">Written/electronic, signed & dated, expires annually (§744.2653)</div>
                        </div>
                        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; border-left: 4px solid var(--success);">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <span style="color: var(--success); font-size: 24px;">✓</span>
                                <strong style="font-size: 14px;">Original Container Only</strong>
                            </div>
                            <div style="font-size: 13px; color: var(--gray-700);">Child's name, date brought, cannot be expired (§744.2655)</div>
                        </div>
                        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; border-left: 4px solid var(--success);">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <span style="color: var(--success); font-size: 24px;">✓</span>
                                <strong style="font-size: 14px;">Dual-Staff Verification</strong>
                            </div>
                            <div style="font-size: 13px; color: var(--gray-700);">One administers, one witnesses - both sign log</div>
                        </div>
                        <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; border-left: 4px solid var(--success);">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <span style="color: var(--success); font-size: 24px;">✓</span>
                                <strong style="font-size: 14px;">Secure Storage</strong>
                            </div>
                            <div style="font-size: 13px; color: var(--gray-700);">Locked, out of reach, separate from food (§744.2657)</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="tabs">
                        <button class="tab active">Active Medications (12)</button>
                        <button class="tab">Today's Log (3)</button>
                        <button class="tab">Expired Authorizations (2)</button>
                        <button class="tab">Food Allergies (5)</button>
                    </div>

                    <table class="table">
                        <thead>
                            <tr>
                                <th>Child Name</th>
                                <th>Medication</th>
                                <th>Dosage</th>
                                <th>Schedule</th>
                                <th>Authorization</th>
                                <th>Container Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Emma S.</strong></td>
                                <td>Albuterol Inhaler<br><small>For asthma</small></td>
                                <td>2 puffs</td>
                                <td>As needed<br><small>Max 4x/day</small></td>
                                <td><span class="badge badge-complete">Valid until Mar 2026</span></td>
                                <td><span class="badge badge-complete">✓ Original, labeled</span></td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;" onclick="openModal('administer-medication')">Log Dose</button></td>
                            </tr>
                            <tr>
                                <td><strong>Liam M.</strong></td>
                                <td>Amoxicillin<br><small>Antibiotic</small></td>
                                <td>5 mL</td>
                                <td>12:00 PM daily<br><small>7 days remaining</small></td>
                                <td><span class="badge badge-complete">Valid until Oct 2025</span></td>
                                <td><span class="badge badge-complete">✓ Original, refrigerated</span></td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--warning); color: white; border: none; border-radius: 4px; cursor: pointer;" onclick="openModal('administer-medication')">Due in 15 min</button></td>
                            </tr>
                            <tr>
                                <td><strong>Olivia K.</strong></td>
                                <td>EpiPen Jr<br><small>Food allergy emergency</small></td>
                                <td>0.15 mg</td>
                                <td>Emergency only<br><small>Severe peanut allergy</small></td>
                                <td><span class="badge badge-complete">Valid until Jun 2026</span></td>
                                <td><span class="badge badge-complete">✓ Original, temp-controlled</span></td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--gray-300); color: var(--gray-700); border: none; border-radius: 4px; cursor: pointer;">View Plan</button></td>
                            </tr>
                            <tr>
                                <td><strong>Noah B.</strong></td>
                                <td>Methylphenidate<br><small>ADHD medication</small></td>
                                <td>10 mg</td>
                                <td>11:00 AM daily</td>
                                <td><span class="badge badge-complete">Valid until Dec 2025</span></td>
                                <td><span class="badge badge-complete">✓ Original, locked</span></td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--success); color: white; border: none; border-radius: 4px; cursor: pointer;">✓ Given 11:05 AM</button></td>
                            </tr>
                            <tr>
                                <td><strong>Sophia L.</strong></td>
                                <td>Children's Tylenol<br><small>Fever/pain relief</small></td>
                                <td>10 mL (160mg)</td>
                                <td>As needed<br><small>Parent permission required</small></td>
                                <td><span class="badge badge-complete">Valid until Aug 2026</span></td>
                                <td><span class="badge badge-complete">✓ Original, labeled</span></td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">Log Dose</button></td>
                            </tr>
                            <tr>
                                <td><strong>Jackson P.</strong></td>
                                <td>Omeprazole<br><small>Acid reflux</small></td>
                                <td>10 mg</td>
                                <td>9:00 AM daily</td>
                                <td><span class="badge" style="background: #fef3c7; color: #92400e;">Expires Dec 15, 2025</span></td>
                                <td><span class="badge badge-complete">✓ Original, labeled</span></td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--success); color: white; border: none; border-radius: 4px; cursor: pointer;">✓ Given 9:05 AM</button></td>
                            </tr>
                            <tr>
                                <td><strong>Ava W.</strong></td>
                                <td>Zyrtec<br><small>Seasonal allergies</small></td>
                                <td>5 mg</td>
                                <td>8:00 AM daily</td>
                                <td><span class="badge badge-complete">Valid until May 2026</span></td>
                                <td><span class="badge badge-complete">✓ Original, labeled</span></td>
                                <td><button class="btn-small" style="padding: 4px 12px; font-size: 12px; background: var(--success); color: white; border: none; border-radius: 4px; cursor: pointer;">✓ Given 8:10 AM</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">📋 Today's Administration Log - October 3, 2025</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Child</th>
                                <th>Medication</th>
                                <th>Dosage Given</th>
                                <th>Administered By</th>
                                <th>Witnessed By</th>
                                <th>Photo Verification</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>11:05 AM</strong></td>
                                <td>Noah B.</td>
                                <td>Methylphenidate 10mg</td>
                                <td>1 tablet (10mg)</td>
                                <td>Sarah Johnson</td>
                                <td>Michael Chen</td>
                                <td><span class="badge badge-complete">✓ Container photo</span></td>
                            </tr>
                            <tr>
                                <td><strong>9:05 AM</strong></td>
                                <td>Jackson P.</td>
                                <td>Omeprazole 10mg</td>
                                <td>1 capsule (10mg)</td>
                                <td>Emily Rodriguez</td>
                                <td>Sarah Johnson</td>
                                <td><span class="badge badge-complete">✓ Container photo</span></td>
                            </tr>
                            <tr>
                                <td><strong>8:10 AM</strong></td>
                                <td>Ava W.</td>
                                <td>Zyrtec 5mg</td>
                                <td>1 tablet (5mg)</td>
                                <td>Sarah Johnson</td>
                                <td>Lisa Thompson</td>
                                <td><span class="badge badge-complete">✓ Container photo</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">🥜 Food Allergy Emergency Plans (Texas §744.2667-2669)</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="padding: 16px; background: #fee2e2; border-radius: 8px; border-left: 4px solid var(--danger);">
                            <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 8px;">
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Olivia K. - SEVERE Peanut Allergy</strong>
                                    <div style="font-size: 13px; color: #991b1b; margin-top: 4px; font-weight: 600;">⚠️ ANAPHYLAXIS RISK - EpiPen required</div>
                                    <div style="font-size: 13px; color: #7c2d12; margin-top: 8px;">
                                        <strong>Allergens:</strong> Peanuts, tree nuts (almonds, cashews, walnuts)<br>
                                        <strong>Symptoms:</strong> Hives, swelling, difficulty breathing, vomiting<br>
                                        <strong>Emergency Action:</strong> 1) Administer EpiPen Jr to outer thigh 2) Call 911 3) Call parents 4) Second dose if no improvement in 5-10 min
                                    </div>
                                </div>
                                <span class="badge" style="background: white; color: #991b1b; border: 2px solid #991b1b;">Plan signed by Dr. Martinez & parent</span>
                            </div>
                            <div style="margin-top: 12px; padding: 12px; background: white; border-radius: 6px;">
                                <strong style="font-size: 13px;">Posted Locations:</strong> Kitchen ✓ | Classroom 2A ✓ | Cafeteria ✓ | Office ✓
                            </div>
                        </div>
                        <div style="padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid var(--warning);">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Mason T. - Dairy Allergy</strong>
                                    <div style="font-size: 13px; color: #78350f; margin-top: 8px;">
                                        <strong>Allergens:</strong> Milk, cheese, yogurt, butter<br>
                                        <strong>Symptoms:</strong> Stomach pain, diarrhea, skin rash<br>
                                        <strong>Action:</strong> Remove from exposure, call parents, monitor for worsening symptoms
                                    </div>
                                </div>
                                <span class="badge badge-complete">Plan on file</span>
                            </div>
                        </div>
                        <div style="padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid var(--warning);">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="flex: 1;">
                                    <strong style="font-size: 14px;">Harper G. - Shellfish Allergy</strong>
                                    <div style="font-size: 13px; color: #78350f; margin-top: 8px;">
                                        <strong>Allergens:</strong> Shrimp, crab, lobster, oysters<br>
                                        <strong>Symptoms:</strong> Hives, itching, swelling of lips/tongue<br>
                                        <strong>Action:</strong> Benadryl 12.5mg if mild reaction, call parents, 911 if breathing difficulty
                                    </div>
                                </div>
                                <span class="badge badge-complete">Plan on file</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Medication Authorization Modal -->
    <div id="add-medication" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">New Medication Authorization 💊</h2>
                <p style="font-size: 14px; color: var(--gray-700); margin-top: 8px;">Texas §744.2653 - Parent authorization required</p>
            </div>
            <form id="add-medication-form" onsubmit="addMedication(event)">
                <div class="form-group">
                    <label class="form-label">Child Name</label>
                    <input id="med-child-name" type="text" class="form-input" placeholder="Select child..." required>
                </div>
                <div class="form-group">
                    <label class="form-label">Medication Name</label>
                    <input id="med-name" type="text" class="form-input" placeholder="e.g., Amoxicillin, Albuterol" required>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select id="med-type" class="form-input" required>
                            <option value="prescription">Prescription</option>
                            <option value="otc">Non-Prescription (OTC)</option>
                            <option value="emergency">Emergency (EpiPen, Inhaler)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dosage</label>
                        <input id="med-dosage" type="text" class="form-input" placeholder="e.g., 5 mL, 10 mg, 2 puffs" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Administration Schedule</label>
                    <select id="med-schedule" class="form-input" required>
                        <option>Scheduled Daily (specific time)</option>
                        <option>Multiple Times Per Day</option>
                        <option>As Needed (PRN)</option>
                        <option>Emergency Only</option>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <input id="med-start-date" type="date" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date / Authorization Expiration</label>
                        <input id="med-end-date" type="date" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Special Instructions / Conditions</label>
                    <textarea id="med-instructions" class="form-input" rows="2" placeholder="e.g., Give with food, monitor for side effects..."></textarea>
                </div>
                <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; margin-top: 16px;">
                    <strong style="font-size: 13px; display: block; margin-bottom: 8px;">✓ Texas Requirements Checklist:</strong>
                    <div style="font-size: 12px; color: var(--gray-700); line-height: 1.8;">
                        • Parent written/electronic authorization (§744.2653)<br>
                        • Original container with child's name and date<br>
                        • Cannot exceed label instructions or doctor's orders<br>
                        • Authorization expires after 1 year<br>
                        • Medication must not be expired
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-medication')">Cancel</button>
                    <button id="add-medication-btn" type="submit" class="btn btn-primary">Save Medication Authorization</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Administer Medication Modal -->
    <div id="administer-medication" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Administer Medication 💊</h2>
                <p style="font-size: 14px; color: var(--gray-700); margin-top: 8px;">Dual-staff verification required</p>
            </div>
            <form>
                <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <strong style="font-size: 14px; display: block; margin-bottom: 8px;">Medication Details:</strong>
                    <div style="font-size: 13px; color: var(--gray-700);">
                        <strong>Child:</strong> Liam M.<br>
                        <strong>Medication:</strong> Amoxicillin 5 mL<br>
                        <strong>Scheduled Time:</strong> 12:00 PM<br>
                        <strong>Authorization:</strong> Valid until Oct 2025 ✓
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Actual Time Administered</label>
                    <input type="time" class="form-input" value="12:03" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Dosage Given (confirm matches authorization)</label>
                    <input type="text" class="form-input" value="5 mL" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Administered By (Staff Member 1)</label>
                    <select class="form-input" required>
                        <option>Sarah Johnson</option>
                        <option>Michael Chen</option>
                        <option>Emily Rodriguez</option>
                        <option>David Martinez</option>
                        <option>Lisa Thompson</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Witnessed By (Staff Member 2 - Required)</label>
                    <select class="form-input" required>
                        <option>Michael Chen</option>
                        <option>Sarah Johnson</option>
                        <option>Emily Rodriguez</option>
                        <option>David Martinez</option>
                        <option>Lisa Thompson</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Verification Photo (Recommended)</label>
                    <div style="border: 2px dashed var(--gray-300); border-radius: 8px; padding: 24px; text-align: center; cursor: pointer;">
                        <div style="font-size: 36px; margin-bottom: 8px;">📷</div>
                        <div style="font-size: 13px; color: var(--gray-700);">Photo of medication container before administration</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes (Optional)</label>
                    <textarea class="form-input" rows="2" placeholder="Any observations, child's reaction, etc..."></textarea>
                </div>
                <div style="background: #dcfce7; padding: 12px; border-radius: 8px; margin-top: 16px; font-size: 13px; color: #065f46;">
                    <strong>✓ Texas §744.2655 Requirements Met:</strong><br>
                    • Following label directions ✓<br>
                    • Original container verified ✓<br>
                    • Administered only to intended child ✓<br>
                    • Medication not expired ✓<br>
                    • Recording child name, medication, date, time, amount, staff name ✓
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('administer-medication')">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="closeModal('administer-medication')">Save & Notify Parent</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Upload Document Modal (4-Step Enhanced) -->
    <div id="upload-document" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title">Upload Document 📁</h2>
                <div style="display: flex; gap: 8px; margin-top: 12px; font-size: 12px;">
                    <div id="step-indicator-1" style="flex: 1; padding: 4px; background: var(--primary); color: white; text-align: center; border-radius: 4px;">1. Basic Info</div>
                    <div id="step-indicator-2" style="flex: 1; padding: 4px; background: var(--gray-200); color: var(--gray-600); text-align: center; border-radius: 4px;">2. Dates</div>
                    <div id="step-indicator-3" style="flex: 1; padding: 4px; background: var(--gray-200); color: var(--gray-600); text-align: center; border-radius: 4px;">3. Upload</div>
                    <div id="step-indicator-4" style="flex: 1; padding: 4px; background: var(--gray-200); color: var(--gray-600); text-align: center; border-radius: 4px;">4. Review</div>
                </div>
            </div>
            <form>
                <!-- Step 1: Basic Information -->
                <div id="upload-step-1" class="upload-step">
                    <div class="form-group">
                        <label class="form-label">Document Name</label>
                        <input type="text" id="upload-doc-name" class="form-input" placeholder="e.g., CPR Certification" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Form Number</label>
                        <select id="upload-form-number" class="form-input" required>
                            <option value="">Select a form...</option>
                            <option value="2910">Form 2910 - Application for License</option>
                            <option value="2948">Form 2948 - Plan of Operation</option>
                            <option value="2971">Form 2971 - Background Check Request</option>
                            <option value="2985">Form 2985 - Employment Affidavit</option>
                            <option value="7239">Form 7239 - Incident/Illness Report</option>
                            <option value="7243">Form 7243 - Emergency Phone Numbers</option>
                            <option value="7250">Form 7250 - Staff Training Record</option>
                            <option value="7255">Form 7255 - Medication Authorization</option>
                            <option value="7259">Form 7259 - Personnel Records Evaluation</option>
                            <option value="7260">Form 7260 - Children's Records Evaluation</option>
                            <option value="7263">Form 7263 - Emergency Practices</option>
                            <option value="other">Other (free text)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select id="upload-category" class="form-input" required>
                            <option value="">Select category...</option>
                            <option value="licensing">Licensing & Permits</option>
                            <option value="staff">Staff Records</option>
                            <option value="children">Children</option>
                            <option value="health">Health & Safety</option>
                            <option value="facility">Facility & Inspections</option>
                            <option value="insurance">Insurance</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Violation Weight</label>
                        <select id="upload-violation" class="form-input" required>
                            <option value="">Select weight...</option>
                            <option value="high">High</option>
                            <option value="med-high">Medium-High</option>
                            <option value="medium">Medium</option>
                            <option value="med-low">Medium-Low</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>

                <!-- Step 2: Dates & Association -->
                <div id="upload-step-2" class="upload-step" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label class="form-label">Issue Date</label>
                            <input type="date" id="upload-issue-date" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Expiration Date</label>
                            <input type="date" id="upload-exp-date" class="form-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="upload-no-exp">
                            <span class="form-label" style="margin: 0;">No expiration date</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Associated With</label>
                        <select id="upload-associated" class="form-input" required>
                            <option value="">Select association...</option>
                            <option value="facility">Facility-wide</option>
                            <option value="emily">Emily Rodriguez (Staff)</option>
                            <option value="david">David Martinez (Staff)</option>
                            <option value="sarah">Sarah Johnson (Staff)</option>
                            <option value="lisa">Lisa Thompson (Staff)</option>
                            <option value="emma">Emma S. (Child)</option>
                            <option value="other-child">Other Child...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Owner/Subject</label>
                        <input type="text" id="upload-owner" class="form-input" placeholder="Auto-filled based on selection" required>
                    </div>
                </div>

                <!-- Step 3: File Upload -->
                <div id="upload-step-3" class="upload-step" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Upload File</label>
                        <div style="border: 2px dashed var(--gray-300); border-radius: 8px; padding: 48px; text-align: center; cursor: pointer; transition: all var(--transition-base);" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='var(--gray-300)'">
                            <div style="font-size: 48px; margin-bottom: 12px;">📄</div>
                            <div style="font-size: 14px; color: var(--gray-900); margin-bottom: 4px; font-weight: 600;">Click to upload or drag & drop</div>
                            <div style="font-size: 12px; color: var(--gray-600);">PDF, JPG, PNG, DOCX (Max 10MB)</div>
                        </div>
                    </div>
                    <div id="upload-preview" style="display: none; margin-top: 16px; padding: 16px; background: var(--gray-50); border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="font-size: 32px;">📄</div>
                            <div style="flex: 1;">
                                <div style="font-size: 14px; font-weight: 600; color: var(--gray-900);">filename.pdf</div>
                                <div style="font-size: 12px; color: var(--gray-600);">2.5 MB</div>
                            </div>
                            <button type="button" style="padding: 4px 8px; font-size: 12px; background: var(--danger); color: white; border: none; border-radius: 4px; cursor: pointer;">Remove</button>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Review & Confirm -->
                <div id="upload-step-4" class="upload-step" style="display: none;">
                    <div style="background: var(--gray-50); border-radius: 8px; padding: 20px;">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--gray-900);">Does this look correct?</h3>
                        <div style="display: grid; gap: 12px;">
                            <div style="display: grid; grid-template-columns: 140px 1fr; gap: 8px;">
                                <div style="font-size: 13px; color: var(--gray-600);">Document Name:</div>
                                <div id="review-doc-name" style="font-size: 13px; font-weight: 600; color: var(--gray-900);">—</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 140px 1fr; gap: 8px;">
                                <div style="font-size: 13px; color: var(--gray-600);">Form Number:</div>
                                <div id="review-form-number" style="font-size: 13px; font-weight: 600; color: var(--gray-900);">—</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 140px 1fr; gap: 8px;">
                                <div style="font-size: 13px; color: var(--gray-600);">Category:</div>
                                <div id="review-category" style="font-size: 13px; font-weight: 600; color: var(--gray-900);">—</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 140px 1fr; gap: 8px;">
                                <div style="font-size: 13px; color: var(--gray-600);">Violation Weight:</div>
                                <div id="review-violation" style="font-size: 13px; font-weight: 600; color: var(--gray-900);">—</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 140px 1fr; gap: 8px;">
                                <div style="font-size: 13px; color: var(--gray-600);">Issue Date:</div>
                                <div id="review-issue-date" style="font-size: 13px; font-weight: 600; color: var(--gray-900);">—</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 140px 1fr; gap: 8px;">
                                <div style="font-size: 13px; color: var(--gray-600);">Expiration Date:</div>
                                <div id="review-exp-date" style="font-size: 13px; font-weight: 600; color: var(--gray-900);">—</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 140px 1fr; gap: 8px;">
                                <div style="font-size: 13px; color: var(--gray-600);">Associated With:</div>
                                <div id="review-associated" style="font-size: 13px; font-weight: 600; color: var(--gray-900);">—</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 140px 1fr; gap: 8px;">
                                <div style="font-size: 13px; color: var(--gray-600);">Owner/Subject:</div>
                                <div id="review-owner" style="font-size: 13px; font-weight: 600; color: var(--gray-900);">—</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer" style="margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('upload-document')">Cancel</button>
                    <button type="button" id="upload-prev-btn" class="btn btn-secondary" style="display: none;" onclick="previousUploadStep()">← Previous</button>
                    <button type="button" id="upload-next-btn" class="btn btn-primary" onclick="nextUploadStep()">Next →</button>
                    <button type="button" id="upload-save-btn" class="btn btn-primary" style="display: none;" onclick="saveDocument()">Save Document</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Missing Required Forms Modal -->
    <div id="missing-forms" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">Missing Required Documents</h2>
                <p style="font-size: 14px; color: var(--gray-600); margin-top: 8px;">Bright Futures Learning Center</p>
            </div>
            <div style="display: flex; flex-direction: column; gap: 24px;">
                <!-- Licensing & Permits -->
                <div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <input type="checkbox" style="width: 16px; height: 16px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900);">LICENSING & PERMITS (2 missing)</h3>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-left: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">Form 2910 - Application for License</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">Current License (MUST BE POSTED)</span>
                                <span class="badge" style="background: var(--danger); color: white; font-size: 10px; padding: 2px 6px; margin-left: 8px;">CRITICAL</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                    </div>
                </div>

                <!-- Staff Records -->
                <div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <input type="checkbox" style="width: 16px; height: 16px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900);">STAFF RECORDS (5 missing)</h3>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-left: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">Form 2971 - Background Check (Sarah Johnson)</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">Form 2985 - Employment Affidavit (Mike Chen)</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">CPR Certification (John Doe)</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">Form 7250 - Staff Training Record (New Hire)</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">TB Test Results (Multiple Staff)</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                    </div>
                </div>

                <!-- Facility & Inspections -->
                <div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <input type="checkbox" style="width: 16px; height: 16px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900);">FACILITY & INSPECTIONS (3 missing)</h3>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-left: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">Fire Inspection Report (Annual - Overdue)</span>
                                <span class="badge" style="background: var(--danger); color: white; font-size: 10px; padding: 2px 6px; margin-left: 8px;">OVERDUE</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">Sanitation Inspection Report</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">Playground Equipment Certification</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                    </div>
                </div>

                <!-- Children -->
                <div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <input type="checkbox" style="width: 16px; height: 16px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900);">CHILDREN (2 missing)</h3>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-left: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">Enrollment Form (New Child - Started Monday)</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--gray-50); border-radius: 6px;">
                            <div>
                                <input type="checkbox" style="margin-right: 8px;">
                                <span style="font-size: 14px; color: var(--gray-900);">Medical Emergency Authorization (Tommy L.)</span>
                            </div>
                            <button class="btn-small btn-primary-small" onclick="openModal('upload-document'); closeModal('missing-forms');">+ Add Document</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="margin-top: 24px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('missing-forms')">Close</button>
                <button type="button" class="btn btn-primary">Print Checklist</button>
            </div>
        </div>
    </div>

    <!-- Inspection Readiness Report Modal -->
    <div id="inspection-readiness" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">📊 Inspection Readiness Report</h2>
                <div style="display: flex; justify-content: space-between; margin-top: 12px;">
                    <p style="font-size: 14px; color: var(--gray-600);">Generated: October 6, 2025 at 3:45 PM</p>
                    <p style="font-size: 14px; color: var(--gray-600);">Facility: Bright Futures Learning Center</p>
                </div>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Overall Compliance Score -->
                <div style="padding: 24px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05)); border-radius: 12px; text-align: center;">
                    <div style="font-size: 48px; font-weight: 800; color: var(--warning); margin-bottom: 8px;">87%</div>
                    <div style="font-size: 16px; font-weight: 600; color: var(--gray-900); margin-bottom: 4px;">OVERALL COMPLIANCE SCORE</div>
                    <div style="display: inline-block; padding: 6px 16px; background: var(--warning); color: white; border-radius: 20px; font-size: 14px; font-weight: 600;">CAUTION</div>
                    <p style="font-size: 13px; color: var(--gray-600); margin-top: 12px;">Address missing items before inspection</p>
                </div>

                <!-- Licensing & Permits -->
                <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900);">✅ LICENSING & PERMITS</h3>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 14px; color: var(--gray-600);">10/12 Complete</span>
                            <span style="font-size: 18px; font-weight: 700; color: #f59e0b;">83%</span>
                        </div>
                    </div>
                    <div style="width: 100%; height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                        <div style="width: 83%; height: 100%; background: linear-gradient(90deg, #f59e0b, #eab308);"></div>
                    </div>
                    <div style="font-size: 13px; color: var(--gray-700);">
                        ✅ Current License - Posted<br>
                        ✅ Form 2910 - Application<br>
                        ✅ Director's Certificate - Current<br>
                        ❌ MISSING: Form 2948 - Plan of Operation<br>
                        ❌ MISSING: Permit renewal documentation
                    </div>
                </div>

                <!-- Staff Records -->
                <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900);">✅ STAFF RECORDS</h3>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 14px; color: var(--gray-600);">40/45 Complete</span>
                            <span style="font-size: 18px; font-weight: 700; color: #10b981;">89%</span>
                        </div>
                    </div>
                    <div style="width: 100%; height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                        <div style="width: 89%; height: 100%; background: linear-gradient(90deg, #10b981, #059669);"></div>
                    </div>
                    <div style="font-size: 13px; color: var(--gray-700);">
                        ✅ Background Checks (15/15)<br>
                        ⚠️ CPR Certifications (12/15) - 3 expired<br>
                        ✅ Training Records (13/15) - 2 incomplete
                    </div>
                </div>

                <!-- Health & Safety -->
                <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900);">✅ HEALTH & SAFETY</h3>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 14px; color: var(--gray-600);">8/10 Complete</span>
                            <span style="font-size: 18px; font-weight: 700; color: #10b981;">80%</span>
                        </div>
                    </div>
                    <div style="width: 100%; height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                        <div style="width: 80%; height: 100%; background: linear-gradient(90deg, #10b981, #059669);"></div>
                    </div>
                    <div style="font-size: 13px; color: var(--gray-700);">
                        ✅ Health Inspections Current<br>
                        ⚠️ Food Handler Permits - 1 expired<br>
                        ✅ Emergency Procedures Posted
                    </div>
                </div>

                <!-- Facility & Inspections -->
                <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900);">✅ FACILITY & INSPECTIONS</h3>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 14px; color: var(--gray-600);">12/15 Complete</span>
                            <span style="font-size: 18px; font-weight: 700; color: #10b981;">80%</span>
                        </div>
                    </div>
                    <div style="width: 100%; height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                        <div style="width: 80%; height: 100%; background: linear-gradient(90deg, #10b981, #059669);"></div>
                    </div>
                    <div style="font-size: 13px; color: var(--gray-700);">
                        ✅ Building Safety Current<br>
                        ❌ Fire Inspection Overdue<br>
                        ✅ Sanitation Report Current
                    </div>
                </div>

                <!-- Children -->
                <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900);">✅ CHILDREN</h3>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 14px; color: var(--gray-600);">24/26 Complete</span>
                            <span style="font-size: 18px; font-weight: 700; color: #10b981;">92%</span>
                        </div>
                    </div>
                    <div style="width: 100%; height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                        <div style="width: 92%; height: 100%; background: linear-gradient(90deg, #10b981, #059669);"></div>
                    </div>
                    <div style="font-size: 13px; color: var(--gray-700);">
                        ✅ Immunization Records Current<br>
                        ✅ Emergency Contacts Verified<br>
                        ⚠️ 2 enrollment forms pending
                    </div>
                </div>

                <!-- Insurance -->
                <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--gray-900);">✅ INSURANCE</h3>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 14px; color: var(--gray-600);">8/8 Complete</span>
                            <span style="font-size: 18px; font-weight: 700; color: #10b981;">100%</span>
                        </div>
                    </div>
                    <div style="width: 100%; height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                        <div style="width: 100%; height: 100%; background: linear-gradient(90deg, #10b981, #059669);"></div>
                    </div>
                    <div style="font-size: 13px; color: var(--gray-700);">
                        ✅ General Liability - Current<br>
                        ✅ Workers Comp - Current<br>
                        ✅ Vehicle Insurance - Current
                    </div>
                </div>
            </div>

            <div class="modal-footer" style="margin-top: 24px;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('inspection-readiness')">Close</button>
                <button type="button" class="btn" style="background: var(--gray-700); color: white;">🖨️ Print Report</button>
                <button type="button" class="btn btn-primary">📧 Email Report</button>
            </div>
        </div>
    </div>

    <!-- New Incident Modal -->
    <div id="new-incident" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">Log New Incident 🚨</h2>
            </div>
            <form id="new-incident-form" onsubmit="createIncident(event)">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Child Name</label>
                        <input id="incident-child-name" type="text" class="form-input" placeholder="Select child..." required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Incident Type</label>
                        <select id="incident-type" class="form-input" required>
                            <option value="injury">Injury</option>
                            <option value="illness">Illness</option>
                            <option value="behavior">Behavior</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input id="incident-date" type="date" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Time</label>
                        <input id="incident-time" type="time" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <select id="incident-location" class="form-input" required>
                        <option>Playground</option>
                        <option>Classroom</option>
                        <option>Bathroom</option>
                        <option>Cafeteria</option>
                        <option>Hallway</option>
                        <option>Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Description of Incident</label>
                    <textarea id="incident-description" class="form-input" rows="3" placeholder="Describe what happened in detail..." required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">First Aid/Action Taken</label>
                    <textarea id="incident-action" class="form-input" rows="2" placeholder="Band-Aid applied, ice pack provided, etc..." required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Staff Member(s) Present</label>
                    <input id="incident-staff" type="text" class="form-input" placeholder="Sarah Johnson, Michael Chen" required>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input id="incident-notify-parent" type="checkbox" checked>
                        <span class="form-label" style="margin: 0;">Send automatic notification to parent</span>
                    </label>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('new-incident')">Cancel</button>
                    <button id="new-incident-btn" type="submit" class="btn btn-primary">Save & Notify Parent</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Audit Report Modal -->
    <div id="audit-report" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh;">
            <div class="modal-header">
                <h2 class="modal-title">Generate Audit Report 📄</h2>
                <p style="font-size: 14px; color: var(--gray-700); margin-top: 8px;">Comprehensive compliance package for Texas DFPS inspections</p>
            </div>
            
            <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 20px; border-radius: 12px; margin-bottom: 24px;">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                    <div style="font-size: 48px;">✅</div>
                    <div>
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 4px;">Audit-Ready Status</h3>
                        <p style="font-size: 14px; color: var(--gray-700);">Your facility is 94% compliant with all Texas minimum standards</p>
                    </div>
                </div>
                <div class="progress-bar" style="margin-bottom: 8px;">
                    <div class="progress-fill" style="width: 94%;"></div>
                </div>
                <p style="font-size: 13px; color: var(--gray-700);">1 item needs attention before 100% compliance</p>
            </div>

            <div style="max-height: 400px; overflow-y: auto; margin-bottom: 24px;">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Report Will Include:</h3>
                
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                        <span style="color: var(--success); font-size: 20px;">✓</span>
                        <div style="flex: 1;">
                            <strong style="font-size: 14px;">A. Required Postings</strong>
                            <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">License, inspection reports, evacuation diagrams, emergency contacts, employee list</div>
                        </div>
                        <span class="badge badge-complete">Complete</span>
                    </div>

                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                        <span style="color: var(--success); font-size: 20px;">✓</span>
                        <div style="flex: 1;">
                            <strong style="font-size: 14px;">B. Administration & Records</strong>
                            <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Parent handbooks, admission forms, immunization records, attendance logs, incident reports</div>
                        </div>
                        <span class="badge badge-complete">Complete</span>
                    </div>

                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                        <span style="color: var(--warning); font-size: 20px;">⚠</span>
                        <div style="flex: 1;">
                            <strong style="font-size: 14px;">C. Personnel & Training</strong>
                            <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Director qualifications, staff orientation, pre-service training, CPR/First Aid certs, annual training hours</div>
                        </div>
                        <span class="badge badge-pending">1 pending</span>
                    </div>

                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                        <span style="color: var(--success); font-size: 20px;">✓</span>
                        <div style="flex: 1;">
                            <strong style="font-size: 14px;">D. Health & Safety</strong>
                            <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Child/staff ratios, supervision logs, hand hygiene, medication records</div>
                        </div>
                        <span class="badge badge-complete">Complete</span>
                    </div>

                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                        <span style="color: var(--success); font-size: 20px;">✓</span>
                        <div style="flex: 1;">
                            <strong style="font-size: 14px;">E. Facility Compliance</strong>
                            <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Fire inspection reports, emergency drills, playground inspections, sanitation records</div>
                        </div>
                        <span class="badge badge-complete">Complete</span>
                    </div>

                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                        <span style="color: var(--success); font-size: 20px;">✓</span>
                        <div style="flex: 1;">
                            <strong style="font-size: 14px;">F. Incident & Illness Documentation</strong>
                            <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Last 3 months of incident reports (8 total), all parent signatures obtained</div>
                        </div>
                        <span class="badge badge-complete">Complete</span>
                    </div>

                    <div style="display: flex; align-items: start; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                        <span style="color: var(--success); font-size: 20px;">✓</span>
                        <div style="flex: 1;">
                            <strong style="font-size: 14px;">G. Medication Administration Records</strong>
                            <div style="font-size: 13px; color: var(--gray-700); margin-top: 4px;">Parent authorizations, original containers, administration logs with dual signatures, secure storage</div>
                        </div>
                        <span class="badge badge-complete">Complete</span>
                    </div>
                </div>
            </div>

            <div style="border-top: 1px solid var(--gray-200); padding-top: 20px;">
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Export Options:</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 8px; padding: 12px; border: 2px solid var(--gray-200); border-radius: 8px; cursor: pointer;">
                        <input type="radio" name="export-format" checked>
                        <div>
                            <div style="font-size: 14px; font-weight: 600;">PDF Package</div>
                            <div style="font-size: 12px; color: var(--gray-700);">Print or email to inspector</div>
                        </div>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; padding: 12px; border: 2px solid var(--gray-200); border-radius: 8px; cursor: pointer;">
                        <input type="radio" name="export-format">
                        <div>
                            <div style="font-size: 14px; font-weight: 600;">Digital Link</div>
                            <div style="font-size: 12px; color: var(--gray-700);">Share secure online link</div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('audit-report')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="generateReport()">Generate Report (5 seconds)</button>
            </div>
        </div>
    </div>

    <!-- Add Staff Modal -->
    <div id="add-staff" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Staff Member</h2>
            </div>
            <form id="add-staff-form" onsubmit="addStaff(event)">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input id="staff-name" type="text" class="form-input" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <input id="staff-role" type="text" class="form-input" placeholder="Teacher" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input id="staff-email" type="email" class="form-input" placeholder="john@example.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Hire Date</label>
                    <input id="staff-hire-date" type="date" class="form-input" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-staff')">Cancel</button>
                    <button id="add-staff-btn" type="submit" class="btn btn-primary">Add Staff Member</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // =============================================
        // API CLIENT & AUTHENTICATION
        // =============================================
        
        // Determine API base URL based on environment
        function getApiBaseUrl() {
            // Just use relative URLs - backend is on same domain
            return '/api';
        }
        
        const API_BASE_URL = getApiBaseUrl();
        console.log('API Base URL:', API_BASE_URL);
        
        const AppState = {
            token: localStorage.getItem('token') || null,
            user: JSON.parse(localStorage.getItem('user') || 'null'),
            facility: JSON.parse(localStorage.getItem('facility') || 'null')
        };
        
        function saveAuthData(token, user, facility) {
            AppState.token = token;
            AppState.user = user;
            AppState.facility = facility;
            localStorage.setItem('token', token);
            localStorage.setItem('user', JSON.stringify(user));
            localStorage.setItem('facility', JSON.stringify(facility));
        }
        
        function clearAuthData() {
            AppState.token = null;
            AppState.user = null;
            AppState.facility = null;
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            localStorage.removeItem('facility');
        }
        
        async function apiRequest(endpoint, options = {}) {
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            if (AppState.token && !options.skipAuth) {
                headers['Authorization'] = `Bearer ${AppState.token}`;
            }
            
            try {
                console.log('API Request:', `${API_BASE_URL}${endpoint}`, options.method || 'GET');
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    ...options,
                    headers
                });
                
                console.log('API Response status:', response.status, response.statusText);
                
                if (!response.ok) {
                    const error = await response.json().catch(() => ({ error: response.statusText }));
                    console.error('API Error response:', error);
                    throw new Error(error.error || error.message || 'Request failed');
                }
                
                const data = await response.json();
                console.log('API Response data:', data);
                return data;
            } catch (error) {
                console.error('API Request failed:', error.message || error);
                throw error;
            }
        }
        
        async function apiUpload(endpoint, formData) {
            const headers = {};
            
            if (AppState.token) {
                headers['Authorization'] = `Bearer ${AppState.token}`;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    method: 'POST',
                    headers,
                    body: formData
                });
                
                if (!response.ok) {
                    const error = await response.json().catch(() => ({ error: response.statusText }));
                    throw new Error(error.error || error.message || 'Upload failed');
                }
                
                return await response.json();
            } catch (error) {
                console.error('Upload failed:', error);
                throw error;
            }
        }
        
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? '✓' : '✕';
            toast.innerHTML = `
                <div class="toast-icon">${icon}</div>
                <div class="toast-message">${message}</div>
                <button class="toast-close" onclick="this.parentElement.remove()">✕</button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        function showError(message) {
            showToast(message, 'error');
        }
        
        function showSuccess(message) {
            showToast(message, 'success');
        }
        
        function setLoading(button, loading = true) {
            if (loading) {
                button.disabled = true;
                button.dataset.originalText = button.textContent;
                button.textContent = 'Loading...';
            } else {
                button.disabled = false;
                button.textContent = button.dataset.originalText || button.textContent;
            }
        }

        // =============================================
        // AUTH FUNCTIONS
        // =============================================
        
        async function login(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showError('Please enter email and password');
                return;
            }
            
            try {
                const data = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
                
                saveAuthData(data.token, data.user, data.facility);
                
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').classList.add('active');
                
                updateFacilityInfo();
                await loadDashboard();
            } catch (error) {
                showError(error.message || 'Login failed');
            }
        }

        async function signup(event) {
            event.preventDefault();
            
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const facilityName = document.getElementById('signup-facility').value;
            const facilityAddress = document.getElementById('signup-address').value;
            
            if (!name || !email || !password || !facilityName) {
                showError('Please fill in all required fields');
                return;
            }
            
            try {
                const data = await apiRequest('/auth/signup', {
                    method: 'POST',
                    body: JSON.stringify({
                        name,
                        email,
                        password,
                        facilityName,
                        facilityAddress
                    })
                });
                
                saveAuthData(data.token, data.user, data.facility);
                
                document.getElementById('signup-screen').style.display = 'none';
                document.getElementById('app').classList.add('active');
                
                updateFacilityInfo();
                await loadDashboard();
            } catch (error) {
                showError(error.message || 'Signup failed');
            }
        }

        function showSignup() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('signup-screen').style.display = 'flex';
        }

        function showLogin() {
            document.getElementById('signup-screen').style.display = 'none';
            document.getElementById('login-screen').style.display = 'flex';
        }

        function logout() {
            clearAuthData();
            document.getElementById('app').classList.remove('active');
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('signup-screen').style.display = 'none';
        }

        // Navigation
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenId).classList.add('active');
            
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
        }

        // =============================================
        // DASHBOARD HELPERS
        // =============================================
        
        async function loadDashboardData() {
            if (!AppState.facility) return;

            try {
                const dashboardData = await apiRequest(`/facilities/${AppState.facility.id}/dashboard`);
                
                // Update greeting
                const hour = new Date().getHours();
                let greeting = 'Good morning';
                if (hour >= 12 && hour < 17) greeting = 'Good afternoon';
                if (hour >= 17) greeting = 'Good evening';
                
                if (AppState.user) {
                    const userName = AppState.user.name || AppState.user.email.split('@')[0];
                    document.getElementById('dashboard-greeting').textContent = `${greeting}, ${userName.split(' ')[0]}!`;
                }

                // Load weather data
                await loadWeatherData();
                
                // Update new dashboard metrics
                updateModernDashboard(dashboardData.data);
            } catch (error) {
                console.error('Failed to load dashboard:', error);
            }
        }

        async function loadWeatherData() {
            if (!AppState.facility) return;
            
            try {
                const weatherResponse = await apiRequest(`/facilities/${AppState.facility.id}/weather`);
                const weather = weatherResponse.data.weather;
                
                if (weather) {
                    const widget = document.getElementById('weather-alert-widget');
                    widget.style.display = 'block';
                    
                    // Show alert icon and title if there's an alert, otherwise show weather icon and condition
                    if (weather.alert) {
                        document.getElementById('weather-icon').textContent = weather.alert.icon;
                        document.getElementById('weather-title').textContent = weather.alert.title;
                        document.getElementById('weather-recommendation').textContent = weather.recommendation;
                        widget.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'; // Red gradient for alerts
                    } else {
                        document.getElementById('weather-icon').textContent = weather.icon;
                        document.getElementById('weather-title').textContent = `${weather.condition} Conditions`;
                        document.getElementById('weather-recommendation').textContent = `Great day for outdoor activities! Temperature: ${weather.temperature}°F, Humidity: ${weather.humidity}%`;
                        widget.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)'; // Blue gradient for normal weather
                    }
                    
                    document.getElementById('weather-location').textContent = weather.location;
                    document.getElementById('weather-temp').textContent = `${weather.temperature}°F`;
                }
            } catch (error) {
                console.log('Weather data unavailable:', error);
            }
        }

        function updateModernDashboard(data) {
            if (!data) return;

            // Update risk score and streak
            if (data.riskScore) {
                document.getElementById('risk-score-display').textContent = data.riskScore.score;
                document.getElementById('risk-rating-display').textContent = data.riskScore.rating;
                const change = data.riskScore.changeFromLastMonth;
                document.getElementById('risk-change-display').textContent = 
                    `${change >= 0 ? '↑' : '↓'} ${Math.abs(change)} from last month`;
            }

            if (data.streak) {
                document.getElementById('streak-days-display').textContent = data.streak.days;
                document.getElementById('next-goal-display').textContent = data.streak.nextGoalName;
            }

            // Update priority cards
            if (data.priorityAlerts) {
                updatePriorityCard('missing-docs', data.priorityAlerts.missingDocs);
                updatePriorityCard('expired-docs', data.priorityAlerts.expiredDocs);
                updatePriorityCard('signatures', data.priorityAlerts.missingSignatures);
            }

            // Update recent activity
            if (data.recentIncidents) {
                updateRecentActivity(data.recentIncidents);
            }
        }

        function updatePriorityCard(type, alertData) {
            const card = document.getElementById(`priority-${type}`);
            const description = document.getElementById(`${type}-description`);
            
            if (!card || !description) return;
            
            if (alertData.count === 0) {
                card.style.opacity = '0.5';
                card.style.cursor = 'default';
                card.onclick = null;
            } else {
                card.style.opacity = '1';
                card.style.cursor = 'pointer';
            }
            
            if (type === 'missing-docs') {
                description.textContent = alertData.count === 0 
                    ? 'All required documents on file ✓'
                    : `${alertData.count} required ${alertData.count === 1 ? 'document' : 'documents'} missing`;
            } else if (type === 'expired-docs') {
                description.textContent = alertData.count === 0
                    ? 'All documents current ✓'
                    : `${alertData.count} ${alertData.count === 1 ? 'document' : 'documents'} expired`;
            } else if (type === 'signatures') {
                description.textContent = alertData.count === 0
                    ? 'All incidents signed ✓'
                    : `${alertData.count} incident ${alertData.count === 1 ? 'report needs' : 'reports need'} parent signature`;
            }
        }

        function updateRecentActivity(incidents) {
            const container = document.getElementById('recent-activity-container');
            if (!container) return;
            
            if (!incidents || incidents.length === 0) {
                container.innerHTML = '<p style="color: #6b7280; text-align: center;">No recent incidents</p>';
                return;
            }
            
            container.innerHTML = incidents.slice(0, 3).map(incident => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e5e7eb;">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #111827;">${incident.childName}</div>
                        <div style="font-size: 13px; color: #6b7280; margin-top: 2px;">${incident.type} - ${incident.description}</div>
                    </div>
                    <div style="text-align: right; font-size: 13px; color: #6b7280;">
                        ${new Date(incident.occurredAt).toLocaleDateString()}
                    </div>
                </div>
            `).join('');
        }

        function updateDashboardMetrics(data) {
            if (!data) return;

            if (data.riskScore !== undefined) {
                const riskScore = data.riskScore;
                document.getElementById('dashboardRiskScore').textContent = riskScore;
                
                let status, message, color;
                if (riskScore >= 80) {
                    status = '🟢';
                    message = 'Great! Risk is low';
                    color = '#059669';
                } else if (riskScore >= 60) {
                    status = '🟡';
                    message = 'Good! Some improvements needed';
                    color = '#d97706';
                } else {
                    status = '🔴';
                    message = 'Action needed to reduce risk';
                    color = '#dc2626';
                }
                
                document.getElementById('dashboardRiskStatus').textContent = status;
                document.getElementById('dashboardRiskMessage').textContent = message;
                document.getElementById('dashboardRiskMessage').style.color = color;
            }

            if (data.compliance !== undefined) {
                const compliancePercent = Math.round(data.compliance.percentage);
                document.getElementById('dashboardCompliancePercent').textContent = `${compliancePercent}%`;
                
                const pending = data.compliance.pending || 0;
                const completed = data.compliance.completed || 0;
                const total = completed + pending;
                
                let status, message, color;
                if (pending === 0) {
                    status = '🟢';
                    message = 'Perfect! All requirements met';
                    color = '#059669';
                } else if (pending === 1) {
                    status = '🟡';
                    message = 'Excellent! 1 item pending';
                    color = '#d97706';
                } else {
                    status = '🟡';
                    message = `Good! ${pending} items pending`;
                    color = '#d97706';
                }
                
                document.getElementById('dashboardComplianceStatus').textContent = status;
                document.getElementById('dashboardComplianceMessage').textContent = message;
                document.getElementById('dashboardComplianceMessage').style.color = color;
                document.getElementById('dashboardComplianceDetails').textContent = `${completed} of ${total} requirements complete`;
            }

            if (data.staffCertified !== undefined) {
                document.getElementById('dashboardStaffCertified').textContent = data.staffCertified || '0/0';
            }

            if (data.trainingCompletion !== undefined) {
                const trainingPercent = Math.round(data.trainingCompletion);
                document.getElementById('dashboardTrainingPercent').textContent = `${trainingPercent}%`;
            }
        }

        async function checkUrgentItems() {
            if (!AppState.facility) return;

            try {
                const urgentItems = [];
                
                const staffResponse = await apiRequest(`/facilities/${AppState.facility.id}/staff`);
                const staff = staffResponse.data || [];
                
                const today = new Date();
                const sevenDaysFromNow = new Date(today);
                sevenDaysFromNow.setDate(today.getDate() + 7);

                staff.forEach(member => {
                    if (member.certifications) {
                        if (member.certifications.cpr && new Date(member.certifications.cpr) < sevenDaysFromNow) {
                            const daysUntil = Math.ceil((new Date(member.certifications.cpr) - today) / (1000 * 60 * 60 * 24));
                            if (daysUntil <= 7 && daysUntil >= 0) {
                                urgentItems.push(`${member.name.split(' ')[0]}'s CPR (${daysUntil} days)`);
                            }
                        }
                        if (member.certifications.firstAid && new Date(member.certifications.firstAid) < sevenDaysFromNow) {
                            const daysUntil = Math.ceil((new Date(member.certifications.firstAid) - today) / (1000 * 60 * 60 * 24));
                            if (daysUntil <= 7 && daysUntil >= 0) {
                                urgentItems.push(`${member.name.split(' ')[0]}'s First Aid (${daysUntil} days)`);
                            }
                        }
                    }
                });

                const incidentsResponse = await apiRequest(`/facilities/${AppState.facility.id}/incidents`);
                const incidents = incidentsResponse.data || [];
                const pendingSignatures = incidents.filter(inc => !inc.parentSignature);
                
                if (pendingSignatures.length > 0) {
                    urgentItems.push(`${pendingSignatures.length} incident signature${pendingSignatures.length > 1 ? 's' : ''} pending`);
                }

                const banner = document.getElementById('urgentBanner');
                if (urgentItems.length > 0) {
                    banner.style.display = 'block';
                    document.getElementById('urgentBannerTitle').textContent = 
                        `${urgentItems.length} Item${urgentItems.length > 1 ? 's' : ''} Need${urgentItems.length === 1 ? 's' : ''} Attention This Week`;
                    document.getElementById('urgentBannerDetails').textContent = urgentItems.slice(0, 3).join(' • ');
                } else {
                    banner.style.display = 'none';
                }
            } catch (error) {
                console.error('Failed to check urgent items:', error);
            }
        }

        function showUrgentItems() {
            showScreen('staff');
        }

        function showRiskDetails() {
            showScreen('licensing');
        }

        async function scheduleRenewal(staffId) {
            showSuccess('Opening staff certification renewal...');
            showScreen('staff');
        }

        async function loadUpcomingItems() {
            if (!AppState.facility) return;

            try {
                const staffResponse = await apiRequest(`/facilities/${AppState.facility.id}/staff`);
                const staff = staffResponse.data || [];
                
                const today = new Date();
                const thirtyDaysFromNow = new Date(today);
                thirtyDaysFromNow.setDate(today.getDate() + 30);

                const upcomingItems = [];

                staff.forEach(member => {
                    if (member.certifications) {
                        if (member.certifications.cpr) {
                            const expiryDate = new Date(member.certifications.cpr);
                            if (expiryDate > today && expiryDate <= thirtyDaysFromNow) {
                                const daysUntil = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                                upcomingItems.push({
                                    type: 'cpr',
                                    staffName: member.name,
                                    staffId: member.id,
                                    expiryDate,
                                    daysUntil,
                                    label: 'CPR Certification'
                                });
                            }
                        }
                        if (member.certifications.firstAid) {
                            const expiryDate = new Date(member.certifications.firstAid);
                            if (expiryDate > today && expiryDate <= thirtyDaysFromNow) {
                                const daysUntil = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                                upcomingItems.push({
                                    type: 'firstAid',
                                    staffName: member.name,
                                    staffId: member.id,
                                    expiryDate,
                                    daysUntil,
                                    label: 'First Aid'
                                });
                            }
                        }
                    }
                });

                upcomingItems.sort((a, b) => a.expiryDate - b.expiryDate);

                renderUpcomingItems(upcomingItems.slice(0, 3));
            } catch (error) {
                console.error('Failed to load upcoming items:', error);
            }
        }

        function renderUpcomingItems(items) {
            const container = document.getElementById('upcomingItemsList');
            
            if (items.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #6b7280;">
                        <div style="font-size: 48px; margin-bottom: 12px;">✅</div>
                        <div style="font-size: 16px; font-weight: 600; color: #059669;">All Clear!</div>
                        <div style="font-size: 14px; margin-top: 4px;">No urgent items in the next 30 days</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = items.map((item, index) => {
                const colors = [
                    { bg: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)', textPrimary: '#92400e', textSecondary: '#78350f', btnBg: '#f59e0b' },
                    { bg: 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)', textPrimary: '#1e40af', textSecondary: '#1e3a8a', btnBg: '#3b82f6' },
                    { bg: 'linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%)', textPrimary: '#9f1239', textSecondary: '#831843', btnBg: '#db2777' }
                ];
                const color = colors[index % 3];
                
                const month = item.expiryDate.toLocaleDateString('en-US', { month: 'short' }).toUpperCase();
                const day = item.expiryDate.getDate();
                
                return `
                    <div onclick="showScreen('staff')" style="display: flex; gap: 16px; padding: 16px; background: ${color.bg}; border-radius: 12px; cursor: pointer; align-items: center; transition: transform 0.2s;">
                        <div style="min-width: 70px; text-align: center; background: white; padding: 8px; border-radius: 8px;">
                            <div style="font-size: 12px; font-weight: 700; color: ${color.textPrimary};">${month}</div>
                            <div style="font-size: 24px; font-weight: 700; color: ${color.textPrimary};">${day}</div>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 700; color: ${color.textPrimary}; margin-bottom: 2px;">${item.staffName} - ${item.label}</div>
                            <div style="font-size: 13px; color: ${color.textSecondary};">Expires in ${item.daysUntil} days</div>
                        </div>
                        <button onclick="event.stopPropagation(); scheduleRenewal('${item.staffId}')" style="background: ${color.btnBg}; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; white-space: nowrap;">Schedule →</button>
                    </div>
                `;
            }).join('');
        }

        // Filter Requirements
        function filterRequirements(status) {
            const rows = document.querySelectorAll('.requirement-row');
            const tabs = document.querySelectorAll('.tab');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            rows.forEach(row => {
                if (status === 'all') {
                    row.style.display = '';
                } else {
                    if (row.dataset.status === status) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // =============================================
        // DATA LOADING FUNCTIONS
        // =============================================
        
        async function loadDashboard() {
            if (!AppState.facility) return;
            
            try {
                const data = await apiRequest(`/facilities/${AppState.facility.id}/dashboard`);
                
                document.getElementById('facility-name').textContent = AppState.facility.name || 'My Facility';
                document.getElementById('facility-location').textContent = AppState.facility.address?.city || 'Location';
                
                // Load enhanced dashboard data
                await loadDashboardData();
                
                // Update compliance progress bar on licensing screen
                const complianceCard = document.querySelector('#licensing .card');
                if (complianceCard && data.complianceStatus) {
                    const percentageDiv = complianceCard.querySelectorAll('div')[1]; // 2nd div
                    const progressFill = complianceCard.querySelector('.progress-fill');
                    const descText = complianceCard.querySelector('p');
                    
                    if (percentageDiv) percentageDiv.textContent = `${data.complianceStatus.overallPercentage}%`;
                    if (progressFill) progressFill.style.width = `${data.complianceStatus.overallPercentage}%`;
                    if (descText) descText.textContent = 
                        `${data.complianceStatus.completeRequirements} of ${data.complianceStatus.totalRequirements} requirements complete`;
                }
                
            } catch (error) {
                console.error('Failed to load dashboard:', error);
            }
        }
        
        function updateFacilityInfo() {
            if (AppState.facility) {
                const facilityNameEl = document.querySelector('.facility-info h3');
                const facilityLocEl = document.querySelector('.facility-info p');
                if (facilityNameEl) facilityNameEl.textContent = AppState.facility.name;
                if (facilityLocEl) facilityLocEl.textContent = `📍 ${AppState.facility.address?.city}, ${AppState.facility.address?.state}`;
            }
        }
        
        // Validate cached auth data on page load
        async function validateAuth() {
            if (!AppState.token || !AppState.user || !AppState.facility) {
                return false;
            }
            
            try {
                // Validate token and user/facility still exist
                const userData = await apiRequest('/auth/me');
                
                // Update AppState with fresh data from server
                AppState.user = userData.user;
                AppState.facility = userData.facility;
                localStorage.setItem('user', JSON.stringify(userData.user));
                localStorage.setItem('facility', JSON.stringify(userData.facility));
                
                return true;
            } catch (error) {
                console.warn('Auth validation failed:', error.message);
                // Clear stale auth data
                clearAuthData();
                return false;
            }
        }
        
        // Check if user is already logged in on page load
        window.addEventListener('DOMContentLoaded', async () => {
            const isValid = await validateAuth();
            
            if (isValid) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').classList.add('active');
                updateFacilityInfo();
                await loadDashboard();
            } else {
                // Show login screen
                document.getElementById('login-screen').style.display = 'flex';
            }
        });

        // =============================================
        // MODAL & UI FUNCTIONS
        // =============================================
        
        // Generate Audit Report
        function generateReport() {
            const modal = document.getElementById('audit-report');
            const button = event.target;
            button.textContent = 'Generating...';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = '✓ Report Generated!';
                setTimeout(() => {
                    closeModal('audit-report');
                    alert('Audit report generated successfully!\n\nA comprehensive PDF containing all required Texas DFPS documentation has been created.\n\nYou can now:\n• Print the report for in-person inspections\n• Email to licensing@dfps.texas.gov\n• Share via secure link\n\nReport includes 94 pages of documentation across 6 compliance categories.');
                    button.textContent = 'Generate Report (5 seconds)';
                    button.disabled = false;
                }, 500);
            }, 2000);
        }

        // Upload Document Multi-Step Functions
        let currentUploadStep = 1;

        function nextUploadStep() {
            if (currentUploadStep < 4) {
                document.getElementById('upload-step-' + currentUploadStep).style.display = 'none';
                document.getElementById('step-indicator-' + currentUploadStep).style.background = 'var(--gray-200)';
                document.getElementById('step-indicator-' + currentUploadStep).style.color = 'var(--gray-600)';
                
                currentUploadStep++;
                
                document.getElementById('upload-step-' + currentUploadStep).style.display = 'block';
                document.getElementById('step-indicator-' + currentUploadStep).style.background = 'var(--primary)';
                document.getElementById('step-indicator-' + currentUploadStep).style.color = 'white';
                
                // Update buttons
                document.getElementById('upload-prev-btn').style.display = 'inline-block';
                if (currentUploadStep === 4) {
                    document.getElementById('upload-next-btn').style.display = 'none';
                    document.getElementById('upload-save-btn').style.display = 'inline-block';
                    updateReviewSummary();
                }
            }
        }

        function previousUploadStep() {
            if (currentUploadStep > 1) {
                document.getElementById('upload-step-' + currentUploadStep).style.display = 'none';
                document.getElementById('step-indicator-' + currentUploadStep).style.background = 'var(--gray-200)';
                document.getElementById('step-indicator-' + currentUploadStep).style.color = 'var(--gray-600)';
                
                currentUploadStep--;
                
                document.getElementById('upload-step-' + currentUploadStep).style.display = 'block';
                document.getElementById('step-indicator-' + currentUploadStep).style.background = 'var(--primary)';
                document.getElementById('step-indicator-' + currentUploadStep).style.color = 'white';
                
                // Update buttons
                if (currentUploadStep === 1) {
                    document.getElementById('upload-prev-btn').style.display = 'none';
                }
                document.getElementById('upload-next-btn').style.display = 'inline-block';
                document.getElementById('upload-save-btn').style.display = 'none';
            }
        }

        function updateReviewSummary() {
            document.getElementById('review-doc-name').textContent = document.getElementById('upload-doc-name').value || '—';
            
            const formSelect = document.getElementById('upload-form-number');
            document.getElementById('review-form-number').textContent = formSelect.options[formSelect.selectedIndex].text || '—';
            
            const catSelect = document.getElementById('upload-category');
            document.getElementById('review-category').textContent = catSelect.options[catSelect.selectedIndex].text || '—';
            
            const violationSelect = document.getElementById('upload-violation');
            document.getElementById('review-violation').textContent = violationSelect.options[violationSelect.selectedIndex].text || '—';
            
            document.getElementById('review-issue-date').textContent = document.getElementById('upload-issue-date').value || '—';
            document.getElementById('review-exp-date').textContent = document.getElementById('upload-exp-date').value || 'No expiration';
            
            const assocSelect = document.getElementById('upload-associated');
            document.getElementById('review-associated').textContent = assocSelect.options[assocSelect.selectedIndex].text || '—';
            
            document.getElementById('review-owner').textContent = document.getElementById('upload-owner').value || '—';
        }

        async function saveDocument() {
            try {
                const docName = document.getElementById('upload-doc-name')?.value;
                const category = document.getElementById('upload-category')?.value;
                
                if (!docName || !category) {
                    showError('Please fill in document name and category');
                    return;
                }
                
                const documentData = {
                    name: docName,
                    category: category.toLowerCase(),
                    fileName: `${docName.replace(/\s+/g, '_')}.pdf`,
                    filePath: `/uploads/${AppState.facility.id}/${Date.now()}.pdf`,
                    uploadedBy: AppState.user.name
                };
                
                await apiRequest(`/facilities/${AppState.facility.id}/documents/upload`, {
                    method: 'POST',
                    body: JSON.stringify(documentData)
                });
                
                showSuccess('Document uploaded successfully');
                closeModal('upload-document');
                resetUploadModal();
                await loadDocuments(currentDocumentFilter);
            } catch (error) {
                console.error('Failed to upload document:', error);
                showError(error.message || 'Failed to upload document');
            }
        }

        function resetUploadModal() {
            currentUploadStep = 1;
            document.querySelectorAll('.upload-step').forEach(step => step.style.display = 'none');
            document.getElementById('upload-step-1').style.display = 'block';
            
            for (let i = 1; i <= 4; i++) {
                if (i === 1) {
                    document.getElementById('step-indicator-' + i).style.background = 'var(--primary)';
                    document.getElementById('step-indicator-' + i).style.color = 'white';
                } else {
                    document.getElementById('step-indicator-' + i).style.background = 'var(--gray-200)';
                    document.getElementById('step-indicator-' + i).style.color = 'var(--gray-600)';
                }
            }
            
            document.getElementById('upload-prev-btn').style.display = 'none';
            document.getElementById('upload-next-btn').style.display = 'inline-block';
            document.getElementById('upload-save-btn').style.display = 'none';
        }

        // Auto-fill owner based on association
        document.getElementById('upload-associated')?.addEventListener('change', function() {
            const ownerField = document.getElementById('upload-owner');
            const selectedText = this.options[this.selectedIndex].text;
            if (selectedText !== 'Select association...') {
                ownerField.value = selectedText.split(' (')[0];
            }
        });

        // Close modal when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // =============================================
        // MODULE DATA LOADING FUNCTIONS
        // =============================================
        
        // Enhanced showScreen function to load data when switching views
        const originalShowScreen = showScreen;
        showScreen = async function(screenId) {
            originalShowScreen.call(this, screenId);
            
            // Load data for the selected screen
            if (!AppState.facility) return;
            
            switch(screenId) {
                case 'staff':
                    await loadStaffList();
                    break;
                case 'incidents':
                    await loadIncidentList();
                    break;
                case 'medication':
                    await loadMedicationList();
                    break;
                case 'licensing':
                    await loadComplianceList();
                    break;
                case 'checklist':
                    await loadTodayChecklist();
                    break;
                case 'training':
                    await loadTrainingModules();
                    break;
                case 'documents':
                    await loadDocuments();
                    break;
            }
        };
        
        // STAFF MANAGEMENT
        async function loadStaffList() {
            try {
                const response = await apiRequest(`/facilities/${AppState.facility.id}/staff`);
                const tbody = document.querySelector('#staff .data-table tbody');
                if (!tbody) return;
                
                const staff = response.data || [];
                tbody.innerHTML = staff.map(staff => `
                    <tr>
                        <td><strong>${staff.name}</strong></td>
                        <td>${staff.role}</td>
                        <td><span class="badge ${staff.certifications.cpr.valid ? 'badge-success' : 'badge-danger'}">${staff.certifications.cpr.valid ? 'Valid' : 'Expired'}</span></td>
                        <td><span class="badge ${staff.certifications.firstAid.valid ? 'badge-success' : 'badge-danger'}">${staff.certifications.firstAid.valid ? 'Valid' : 'Expired'}</span></td>
                        <td>${staff.certifications.backgroundCheck.status}</td>
                        <td>
                            <div class="progress-bar-sm">
                                <div class="progress-fill" style="width: ${(staff.trainingHours.completed / staff.trainingHours.required * 100).toFixed(0)}%"></div>
                            </div>
                            <small>${staff.trainingHours.completed}/${staff.trainingHours.required} hours</small>
                        </td>
                        <td><button class="btn btn-sm btn-secondary" onclick="viewStaffDetails('${staff.id}')">View Details</button></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Failed to load staff:', error);
                showError('Failed to load staff list');
            }
        }
        
        async function viewStaffDetails(staffId) {
            try {
                const staff = await apiRequest(`/staff/${staffId}`);
                // TODO: Show staff details in a modal or detail view
                showSuccess(`Viewing details for ${staff.name}`);
            } catch (error) {
                console.error('Failed to load staff details:', error);
                showError('Failed to load staff details');
            }
        }
        
        async function addStaff(event) {
            event.preventDefault();
            
            const button = document.getElementById('add-staff-btn');
            setLoading(button, true);
            
            const staffData = {
                name: document.getElementById('staff-name').value,
                role: document.getElementById('staff-role').value,
                email: document.getElementById('staff-email').value,
                hireDate: document.getElementById('staff-hire-date').value
            };
            
            try {
                await apiRequest(`/facilities/${AppState.facility.id}/staff`, {
                    method: 'POST',
                    body: JSON.stringify(staffData)
                });
                
                showSuccess('Staff member added successfully');
                document.getElementById('add-staff-form').reset();
                closeModal('add-staff');
                await loadStaffList();
            } catch (error) {
                console.error('Failed to add staff:', error);
                showError(error.message || 'Failed to add staff member');
            } finally {
                setLoading(button, false);
            }
        }
        
        // INCIDENT REPORTING
        let currentIncidentFilter = 'all';
        
        async function loadIncidentList(filter = 'all') {
            try {
                currentIncidentFilter = filter;
                let url = `/facilities/${AppState.facility.id}/incidents`;
                if (filter && filter !== 'all') {
                    url += `?type=${filter}`;
                }
                
                const response = await apiRequest(url);
                const tbody = document.querySelector('#incidents .data-table tbody');
                if (!tbody) return;
                
                const incidents = response.data || [];
                tbody.innerHTML = incidents.map(incident => {
                    const date = new Date(incident.dateTime);
                    const severityClass = incident.severity === 'critical' ? 'badge-danger' : 
                                         incident.severity === 'moderate' ? 'badge-warning' : 'badge-info';
                    return `
                        <tr>
                            <td>${date.toLocaleDateString()}</td>
                            <td>${incident.childInfo.name}</td>
                            <td><span class="badge ${incident.type === 'injury' ? 'badge-danger' : incident.type === 'illness' ? 'badge-warning' : 'badge-info'}">${incident.type.charAt(0).toUpperCase() + incident.type.slice(1)}</span></td>
                            <td><span class="badge ${severityClass}">${incident.severity.charAt(0).toUpperCase() + incident.severity.slice(1)}</span></td>
                            <td>${incident.description.substring(0, 50)}...</td>
                            <td><span class="badge ${incident.parentSignature ? 'badge-success' : 'badge-warning'}">${incident.parentSignature ? 'Signed' : 'Pending'}</span></td>
                            <td><button class="btn btn-sm btn-secondary" onclick="viewIncidentDetails('${incident.id}')">View</button></td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Failed to load incidents:', error);
                showError('Failed to load incident list');
            }
        }
        
        async function viewIncidentDetails(incidentId) {
            try {
                const incident = await apiRequest(`/incidents/${incidentId}`);
                showSuccess(`Viewing incident for ${incident.childInfo.name}`);
            } catch (error) {
                console.error('Failed to load incident:', error);
                showError('Failed to load incident details');
            }
        }
        
        async function createIncident(event) {
            event.preventDefault();
            
            const button = document.getElementById('new-incident-btn');
            setLoading(button, true);
            
            const date = document.getElementById('incident-date').value;
            const time = document.getElementById('incident-time').value;
            const dateTime = new Date(`${date}T${time}`).toISOString();
            
            const incidentData = {
                type: document.getElementById('incident-type').value,
                severity: 'moderate',
                childInfo: {
                    name: document.getElementById('incident-child-name').value
                },
                location: document.getElementById('incident-location').value,
                description: document.getElementById('incident-description').value,
                immediateActions: document.getElementById('incident-action').value,
                reportedBy: document.getElementById('incident-staff').value,
                dateTime,
                parentNotified: document.getElementById('incident-notify-parent').checked
            };
            
            try {
                await apiRequest(`/facilities/${AppState.facility.id}/incidents`, {
                    method: 'POST',
                    body: JSON.stringify(incidentData)
                });
                
                showSuccess('Incident logged successfully');
                document.getElementById('new-incident-form').reset();
                closeModal('new-incident');
                await loadIncidentList(currentIncidentFilter);
            } catch (error) {
                console.error('Failed to create incident:', error);
                showError(error.message || 'Failed to log incident');
            } finally {
                setLoading(button, false);
            }
        }
        
        function filterIncidents(type) {
            loadIncidentList(type.toLowerCase());
        }
        
        // MEDICATION TRACKING
        let allMedications = [];
        let currentMedicationFilter = 'active';
        
        async function loadMedicationList(filter = 'active') {
            try {
                currentMedicationFilter = filter;
                const response = await apiRequest(`/facilities/${AppState.facility.id}/medications`);
                allMedications = response.data || [];
                
                let filteredMeds = allMedications;
                if (filter === 'active') {
                    filteredMeds = allMedications.filter(med => med.status === 'active');
                } else if (filter === 'expired') {
                    filteredMeds = allMedications.filter(med => med.status === 'expired');
                } else if (filter === 'today') {
                    const today = new Date().toISOString().split('T')[0];
                    filteredMeds = allMedications.filter(med => 
                        med.schedule && med.schedule.toLowerCase().includes('daily')
                    );
                }
                
                const tbody = document.querySelector('#medication .data-table tbody');
                if (!tbody) return;
                
                tbody.innerHTML = filteredMeds.map(med => {
                    const endDate = new Date(med.endDate);
                    return `
                        <tr>
                            <td>${med.childInfo.name}</td>
                            <td><strong>${med.medicationName}</strong></td>
                            <td>${med.dosage}</td>
                            <td>${med.schedule}</td>
                            <td>${endDate.toLocaleDateString()}</td>
                            <td><span class="badge ${med.status === 'active' ? 'badge-success' : 'badge-secondary'}">${med.status.charAt(0).toUpperCase() + med.status.slice(1)}</span></td>
                            <td><button class="btn btn-sm btn-primary" onclick="administerMedication('${med.id}')">Administer</button></td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Failed to load medications:', error);
                showError('Failed to load medication list');
            }
        }
        
        function filterMedications(filter) {
            loadMedicationList(filter);
        }
        
        async function administerMedication(medicationId) {
            try {
                // TODO: Show administration form with dual-staff verification
                showSuccess('Medication administration form - Coming soon');
            } catch (error) {
                console.error('Failed to administer medication:', error);
                showError('Failed to record medication administration');
            }
        }
        
        async function addMedication(event) {
            event.preventDefault();
            
            const button = document.getElementById('add-medication-btn');
            setLoading(button, true);
            
            const medicationData = {
                childInfo: {
                    name: document.getElementById('med-child-name').value
                },
                medicationName: document.getElementById('med-name').value,
                dosage: document.getElementById('med-dosage').value,
                route: 'oral',
                schedule: document.getElementById('med-schedule').value,
                startDate: document.getElementById('med-start-date').value,
                endDate: document.getElementById('med-end-date').value,
                prescribedBy: 'Dr. TBD',
                parentAuthorization: {
                    signedBy: 'Parent',
                    signedAt: new Date().toISOString()
                },
                specialInstructions: document.getElementById('med-instructions').value || ''
            };
            
            try {
                await apiRequest(`/facilities/${AppState.facility.id}/medications`, {
                    method: 'POST',
                    body: JSON.stringify(medicationData)
                });
                
                showSuccess('Medication authorization added successfully');
                document.getElementById('add-medication-form').reset();
                closeModal('add-medication');
                await loadMedicationList(currentMedicationFilter);
            } catch (error) {
                console.error('Failed to add medication:', error);
                showError(error.message || 'Failed to add medication authorization');
            } finally {
                setLoading(button, false);
            }
        }
        
        // COMPLIANCE MANAGEMENT  
        async function loadComplianceList() {
            try {
                const data = await apiRequest(`/facilities/${AppState.facility.id}/compliance`);
                const tbody = document.querySelector('#licensing .data-table tbody');
                if (!tbody) return;
                
                tbody.innerHTML = data.requirements.map(req => {
                    const priorityClass = req.priority === 'High' ? 'badge-danger' : 
                                         req.priority === 'Medium' ? 'badge-warning' : 'badge-info';
                    return `
                        <tr class="requirement-row" data-status="${req.status}">
                            <td>${req.requirement}</td>
                            <td><span class="badge ${priorityClass}">${req.priority}</span></td>
                            <td>${req.frequency}</td>
                            <td>${req.completedAt ? new Date(req.completedAt).toLocaleDateString() : 'Not completed'}</td>
                            <td><span class="badge ${req.status === 'complete' ? 'badge-success' : 'badge-warning'}">${req.status === 'complete' ? 'Complete' : 'Pending'}</span></td>
                            <td>
                                ${req.status !== 'complete' ? 
                                    `<button class="btn btn-sm btn-primary" onclick="markCompleteRequirement('${req.id}')">Mark Complete</button>` : 
                                    `<button class="btn btn-sm btn-secondary" disabled>Completed</button>`
                                }
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Failed to load compliance:', error);
                showError('Failed to load compliance requirements');
            }
        }
        
        async function markCompleteRequirement(reqId) {
            try {
                await apiRequest(`/facilities/${AppState.facility.id}/compliance/${reqId}/complete`, {
                    method: 'POST',
                    body: JSON.stringify({})
                });
                showSuccess('Requirement marked as complete');
                await loadComplianceList();
            } catch (error) {
                console.error('Failed to mark requirement complete:', error);
                showError('Failed to update requirement');
            }
        }
        
        // DAILY CHECKLIST
        async function loadTodayChecklist() {
            try {
                const data = await apiRequest(`/facilities/${AppState.facility.id}/checklist/today`);
                const container = document.querySelector('#checklist .checklist-items');
                if (!container) return;
                
                const groupedTasks = {};
                data.tasks.forEach(task => {
                    if (!groupedTasks[task.category]) {
                        groupedTasks[task.category] = [];
                    }
                    groupedTasks[task.category].push(task);
                });
                
                container.innerHTML = Object.entries(groupedTasks).map(([category, tasks]) => `
                    <div class="checklist-category">
                        <h3>${category}</h3>
                        ${tasks.map(task => `
                            <div class="checklist-item ${task.completed ? 'completed' : ''}">
                                <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                       onchange="toggleChecklistTask('${task.id}')" 
                                       ${task.completed ? 'disabled' : ''}>
                                <div>
                                    <strong>${task.task}</strong>
                                    ${task.completedAt ? `<small>Completed at ${new Date(task.completedAt).toLocaleTimeString()}</small>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load checklist:', error);
                showError('Failed to load daily checklist');
            }
        }
        
        async function toggleChecklistTask(taskId) {
            try {
                await apiRequest(`/facilities/${AppState.facility.id}/checklist/today/tasks/${taskId}/complete`, {
                    method: 'POST',
                    body: JSON.stringify({})
                });
                await loadTodayChecklist();
            } catch (error) {
                console.error('Failed to complete task:', error);
                showError('Failed to update checklist');
            }
        }
        
        // TRAINING HUB
        async function loadTrainingModules() {
            try {
                const data = await apiRequest(`/facilities/${AppState.facility.id}/training/modules`);
                const container = document.querySelector('#training .training-modules');
                if (!container) return;
                
                container.innerHTML = data.modules.map(module => {
                    const completionRate = module.completedByStaff ? 
                        (module.completedByStaff.length / (data.totalStaff || 1) * 100).toFixed(0) : 0;
                    return `
                        <div class="training-card">
                            <h3>${module.title}</h3>
                            <p>${module.description}</p>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${completionRate}%"></div>
                            </div>
                            <p><small>${completionRate}% of staff completed</small></p>
                            <button class="btn btn-sm btn-primary" onclick="completeTraining('${module.id}')">Complete Training</button>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Failed to load training modules:', error);
                showError('Failed to load training modules');
            }
        }
        
        async function completeTraining(moduleId) {
            try {
                await apiRequest(`/training/${moduleId}/complete`, {
                    method: 'POST',
                    body: JSON.stringify({ staffId: AppState.user.id })
                });
                showSuccess('Training module marked as complete');
                await loadTrainingModules();
            } catch (error) {
                console.error('Failed to complete training:', error);
                showError('Failed to complete training');
            }
        }
        
        // DOCUMENT VAULT
        let allDocuments = [];
        let currentDocumentFilter = 'all';
        
        async function loadDocuments(filter = 'all') {
            try {
                currentDocumentFilter = filter;
                const response = await apiRequest(`/facilities/${AppState.facility.id}/documents`);
                allDocuments = response.data || [];
                
                let filteredDocs = allDocuments;
                if (filter && filter !== 'all') {
                    filteredDocs = allDocuments.filter(doc => 
                        doc.category.toLowerCase().replace(/\s+/g, '-') === filter.toLowerCase()
                    );
                }
                
                const tbody = document.querySelector('#documents .data-table tbody');
                if (!tbody) return;
                
                tbody.innerHTML = filteredDocs.map(doc => {
                    const expDate = doc.expirationDate ? new Date(doc.expirationDate) : null;
                    const statusClass = doc.status === 'Current' ? 'badge-success' : 
                                       doc.status === 'Expiring Soon' ? 'badge-warning' : 'badge-danger';
                    return `
                        <tr>
                            <td>${doc.name}</td>
                            <td>${doc.formNumber || '—'}</td>
                            <td>${doc.category}</td>
                            <td>${expDate ? expDate.toLocaleDateString() : 'No expiration'}</td>
                            <td><span class="badge ${statusClass}">${doc.status || 'Current'}</span></td>
                            <td><button class="btn btn-sm btn-secondary" onclick="downloadDocument('${doc.id}')">Download</button></td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Failed to load documents:', error);
                showError('Failed to load documents');
            }
        }
        
        function filterDocuments(category) {
            loadDocuments(category);
        }
        
        async function downloadDocument(docId) {
            try {
                const data = await apiRequest(`/documents/${docId}/download`);
                window.open(data.downloadUrl, '_blank');
            } catch (error) {
                console.error('Failed to download document:', error);
                showError('Failed to download document');
            }
        }
        
    </script>

    <!-- Toast Notification Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Shield AI Chat Assistant -->
    <div class="ai-chat-fab" id="ai-chat-fab" onclick="toggleAIChat()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            <path d="M9 10h.01M15 10h.01M9.5 14.5s1.5 1.5 3 1.5 3-1.5 3-1.5"/>
        </svg>
        <span class="ai-badge">AI</span>
    </div>

    <div class="ai-chat-container" id="ai-chat-container">
        <div class="ai-chat-header">
            <div>
                <h3>🤖 Shield AI</h3>
                <p>Texas DFPS Compliance Assistant</p>
            </div>
            <button class="ai-close-btn" onclick="toggleAIChat()">✕</button>
        </div>
        <div class="ai-chat-messages" id="ai-chat-messages">
            <div class="ai-message ai-message-assistant">
                <div class="ai-avatar">🤖</div>
                <div class="ai-content">
                    <p><strong>Hi! I'm Shield AI.</strong></p>
                    <p>I can help you with Texas DFPS child care regulations and compliance questions.</p>
                    <p>Try asking me:</p>
                    <ul>
                        <li>"What are the medication administration requirements?"</li>
                        <li>"How often do staff need CPR certification?"</li>
                        <li>"What incidents must be reported to DFPS?"</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="ai-chat-input-container">
            <textarea 
                id="ai-chat-input" 
                placeholder="Ask about Texas DFPS regulations..." 
                rows="1"
                onkeydown="handleAIInputKeydown(event)"></textarea>
            <button class="ai-send-btn" onclick="sendAIMessage()" id="ai-send-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <style>
        .ai-chat-fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            transition: all var(--transition-base);
            color: white;
        }

        .ai-chat-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 20px 40px -10px rgba(79, 70, 229, 0.6);
        }

        .ai-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--success);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            border: 2px solid white;
        }

        .ai-chat-container {
            position: fixed;
            bottom: 100px;
            right: 24px;
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
            display: none;
            flex-direction: column;
            z-index: 999;
            animation: slideUp 0.3s ease-out;
        }

        .ai-chat-container.active {
            display: flex;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ai-chat-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 16px 16px 0 0;
        }

        .ai-chat-header h3 {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .ai-chat-header p {
            font-size: 12px;
            opacity: 0.9;
        }

        .ai-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
        }

        .ai-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .ai-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .ai-message {
            display: flex;
            gap: 12px;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ai-message-user {
            flex-direction: row-reverse;
        }

        .ai-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .ai-message-assistant .ai-avatar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .ai-message-user .ai-avatar {
            background: var(--gray-200);
        }

        .ai-content {
            flex: 1;
            background: var(--gray-50);
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.6;
        }

        .ai-message-user .ai-content {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .ai-content p {
            margin-bottom: 8px;
        }

        .ai-content p:last-child {
            margin-bottom: 0;
        }

        .ai-content ul {
            margin-left: 20px;
            margin-top: 8px;
        }

        .ai-content li {
            margin-bottom: 4px;
            font-size: 13px;
        }

        .ai-content strong {
            font-weight: 600;
        }

        .ai-loading {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .ai-loading-dot {
            width: 8px;
            height: 8px;
            background: var(--gray-400);
            border-radius: 50%;
            animation: loadingDot 1.4s infinite ease-in-out both;
        }

        .ai-loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .ai-loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loadingDot {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .ai-chat-input-container {
            padding: 16px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 12px;
            background: white;
            border-radius: 0 0 16px 16px;
        }

        #ai-chat-input {
            flex: 1;
            border: 1px solid var(--gray-300);
            border-radius: 12px;
            padding: 12px 16px;
            font-family: inherit;
            font-size: 14px;
            resize: none;
            max-height: 100px;
            transition: all var(--transition-base);
        }

        #ai-chat-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .ai-send-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
            flex-shrink: 0;
        }

        .ai-send-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .ai-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .ai-chat-container {
                width: calc(100vw - 32px);
                height: calc(100vh - 140px);
                right: 16px;
            }
        }
    </style>

    <script>
        function toggleAIChat() {
            const container = document.getElementById('ai-chat-container');
            container.classList.toggle('active');
            
            if (container.classList.contains('active')) {
                document.getElementById('ai-chat-input').focus();
            }
        }

        function handleAIInputKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendAIMessage();
            }
        }

        async function sendAIMessage() {
            const input = document.getElementById('ai-chat-input');
            const sendBtn = document.getElementById('ai-send-btn');
            const messagesContainer = document.getElementById('ai-chat-messages');
            const question = input.value.trim();

            if (!question) return;

            // Add user message to chat
            addAIMessage(question, 'user');
            input.value = '';
            input.style.height = 'auto';

            // Show loading indicator
            const loadingId = addAILoadingMessage();

            // Disable input
            sendBtn.disabled = true;

            try {
                const response = await apiRequest('/ai/ask', {
                    method: 'POST',
                    body: JSON.stringify({ question })
                });

                // Remove loading message
                removeAIMessage(loadingId);

                // Add AI response
                addAIMessage(response.data.answer, 'assistant');
            } catch (error) {
                // Remove loading message
                removeAIMessage(loadingId);

                // Show error
                addAIMessage('Sorry, I encountered an error. Please try again.', 'assistant');
                showError(error.message || 'Failed to get AI response');
            } finally {
                sendBtn.disabled = false;
            }
        }

        function addAIMessage(content, role) {
            const messagesContainer = document.getElementById('ai-chat-messages');
            const messageId = 'msg-' + Date.now();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `ai-message ai-message-${role}`;
            messageDiv.id = messageId;
            
            const avatar = document.createElement('div');
            avatar.className = 'ai-avatar';
            avatar.textContent = role === 'assistant' ? '🤖' : '👤';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'ai-content';
            
            // Format content with paragraphs
            const paragraphs = content.split('\n\n');
            paragraphs.forEach(para => {
                if (para.trim()) {
                    const p = document.createElement('p');
                    p.innerHTML = formatAIText(para);
                    contentDiv.appendChild(p);
                }
            });
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            return messageId;
        }

        function formatAIText(text) {
            // Bold text between **
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            // Code between ``
            text = text.replace(/`(.*?)`/g, '<code>$1</code>');
            // Line breaks
            text = text.replace(/\n/g, '<br>');
            return text;
        }

        function addAILoadingMessage() {
            const messagesContainer = document.getElementById('ai-chat-messages');
            const loadingId = 'loading-' + Date.now();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message ai-message-assistant';
            messageDiv.id = loadingId;
            
            const avatar = document.createElement('div');
            avatar.className = 'ai-avatar';
            avatar.textContent = '🤖';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'ai-content';
            
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'ai-loading';
            loadingDiv.innerHTML = '<div class="ai-loading-dot"></div><div class="ai-loading-dot"></div><div class="ai-loading-dot"></div>';
            
            contentDiv.appendChild(loadingDiv);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            return loadingId;
        }

        function removeAIMessage(messageId) {
            const message = document.getElementById(messageId);
            if (message) {
                message.remove();
            }
        }

        // Auto-resize textarea
        document.addEventListener('DOMContentLoaded', () => {
            const textarea = document.getElementById('ai-chat-input');
            if (textarea) {
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 100) + 'px';
                });
            }
        });
    </script>
</body>
</html>